<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>강민수의 일본어 단어 공부</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', 'Noto Sans JP', sans-serif;
        }
        .card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .content-hidden {
            visibility: hidden;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: visibility 0s 0.3s, opacity 0.3s ease-out, height 0.3s ease-out;
        }
        .content-visible {
            visibility: visible;
            opacity: 1;
            height: auto; /* Adjusted for dynamic content */
            transition: opacity 0.3s ease-in, height 0.3s ease-in;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 0.5rem;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .memorized-item { background-color: #E0F2FE; }
        .not-memorized-item { background-color: #FEF3C7; }
        .hidden { display: none; }
        .choice-button {
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        .choice-button.correct {
            background-color: #34D399 !important;
            border-color: #34D399 !important;
            color: white !important;
        }
        .choice-button.incorrect {
            background-color: #F87171 !important;
            border-color: #F87171 !important;
            color: white !important;
        }
        .choice-button.selected-incorrect {
            background-color: #F87171 !important;
            border-color: #F87171 !important;
            color: white !important;
        }
        .choice-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .word-display { font-family: 'Noto Sans JP', sans-serif; }
        .reading-display { font-family: 'Noto Sans JP', sans-serif; font-size: 0.9em; color: #555; }
        .meaning-display, .kanji-etymology-display { font-family: 'Noto Sans KR', sans-serif; }
        .top-icon-button {
            color: #4B5563;
            padding: 0.5rem;
            border-radius: 9999px;
            font-size: 1.25rem;
        }
        .top-icon-button:hover {
            color: #1F2937;
            background-color: #E5E7EB;
        }
        .settings-modal-button {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-radius: 0.375rem;
            font-weight: 500;
            color: #374151;
            background-color: #F3F4F6;
            border: 1px solid #D1D5DB;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .settings-modal-button:hover:not(:disabled) {
            background-color: #E5E7EB;
            border-color: #9CA3AF;
        }
        .settings-modal-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .settings-modal-button i {
            margin-right: 0.75rem;
            color: #4B5563;
            width: 1.25rem;
            text-align: center;
        }
        .app-info p {
            margin-bottom: 0.25rem; /* 4px */
            color: #4B5563; /* text-gray-600 */
            font-size: 0.875rem; /* text-sm */
        }
        .app-info p:last-child {
            margin-bottom: 1.5rem; /* mb-6, for spacing before buttons */
        }
        .part-select-button {
            background-color: #f3f4f6; /* bg-gray-100 */
            border-color: #d1d5db; /* border-gray-300 */
            color: #374151; /* text-gray-700 */
            transition: all 0.2s ease-in-out;
        }
        .part-select-button:hover {
            background-color: #e5e7eb; /* hover:bg-gray-200 */
        }
        .part-select-button.active {
            background-color: #43A047; /* green-600 */
            color: white;
            border-color: #43A047;
            font-weight: 700;
        }

    </style>
</head>
<body class="bg-gradient-to-br from-green-400 via-cyan-500 to-blue-600 min-h-screen flex flex-col items-center justify-center p-2 sm:p-4 selection:bg-cyan-300 selection:text-cyan-900">

<div id="learningModeContainer" class="flex justify-center w-full">
    <div class="bg-white shadow-2xl rounded-xl p-4 sm:p-6 w-full sm:w-[672px] card transform transition-all duration-500 ease-in-out">
        <div id="appTopBar" class="w-full flex justify-between items-center py-2 mb-3">
            <button id="playPauseButton" class="top-icon-button focus:outline-none">
                <i class="fas fa-play"></i>
            </button>
            <button id="settingsButton" class="top-icon-button focus:outline-none">
                <i class="fas fa-cog"></i>
            </button>
        </div>
        <div>
            <div class="flex justify-between items-center mb-2 mt-2">
                <div id="wordIdEl" class="text-xs sm:text-sm text-gray-500"></div>
                <button id="toggleMemorizedButton" class="text-xs sm:text-sm py-1 px-2 rounded-md focus:outline-none"></button>
            </div>
            <div id="wordDisplayContainer" class="w-full text-center mb-3 sm:mb-4 p-3 sm:p-4 bg-cyan-50 rounded-lg">
                <div id="wordFormEl" class="word-display text-2xl sm:text-3xl md:text-4xl font-semibold text-cyan-700"></div>
                <div id="wordReadingElContainer" class="content-hidden">
                    <div id="wordReadingEl" class="reading-display text-lg sm:text-xl md:text-2xl text-cyan-600 mt-1"></div>
                </div>
            </div>
            <div id="detailsContainer">
                <div id="meaningContainer" class="content-hidden">
                    <h2 class="text-base sm:text-lg md:text-xl font-semibold text-blue-700 mt-3 sm:mt-4 mb-1 sm:mb-2">뜻:</h2>
                    <p id="wordMeaningEl" class="meaning-display text-gray-700 bg-blue-50 p-2 sm:p-3 rounded-md text-sm sm:text-base md:text-lg"></p>
                </div>
                <div id="kanjiEtymologyContainer" class="content-hidden">
                    <h2 class="text-base sm:text-lg md:text-xl font-semibold text-purple-700 mt-3 sm:mt-4 mb-1 sm:mb-2">한자 풀이:</h2>
                    <p id="kanjiEtymologyEl" class="kanji-etymology-display text-gray-700 bg-purple-50 p-2 sm:p-3 rounded-md text-sm sm:text-base md:text-lg"></p>
                </div>
            </div>
        </div>
        <div class="mt-6 sm:mt-8 space-y-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <button id="revealHiraganaButton" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2.5 sm:py-3 px-4 rounded-lg shadow-md text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-purple-400 flex items-center justify-center">
                    히라가나 보기
                </button>
                <button id="revealMeaningButton" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2.5 sm:py-3 px-4 rounded-lg shadow-md text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-teal-400 flex items-center justify-center">
                    한글 뜻 보기
                </button>
            </div>
            <div class="flex items-center gap-x-3 mt-3">
                <button id="prevButton" class="flex-1 bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2.5 sm:py-3 px-4 rounded-lg shadow-md text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-sky-300">
                    이전
                </button>
                <button id="nextButton" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-2.5 sm:py-3 px-4 rounded-lg shadow-md text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-red-300">
                    다음
                </button>
            </div>
        </div>
    </div>
</div>

<div id="testModeContainer" class="hidden bg-white shadow-2xl rounded-xl p-4 sm:p-6 w-full max-w-2xl card transform transition-all duration-500 ease-in-out">
    <div>
        <h2 class="text-xl sm:text-2xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-teal-500 to-cyan-500 mb-4 sm:mb-6">단어 학습 (발음 선택)</h2>
        <div id="testProgressEl" class="text-sm text-gray-600 mb-2 text-center"></div>
        <div id="testWordFormEl" class="w-full text-lg sm:text-xl md:text-2xl font-semibold text-teal-700 mb-3 p-3 sm:p-4 bg-teal-50 rounded-lg text-center word-display"></div>
        <div id="testChoicesEl" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
        </div>
        <div id="testResultEl" class="text-center font-semibold mb-4 p-2 rounded-md min-h-[2.5rem] meaning-display">
        </div>
    </div>
    <div class="mt-6 sm:mt-8 flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0 sm:space-x-4">
        <button id="quitTestButton" class="w-full sm:w-1/3 bg-red-500 hover:bg-red-600 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md text-sm focus:outline-none focus:ring-2 focus:ring-red-400">
            학습 종료
        </button>
        <button id="nextTestItemButton" class="w-full sm:w-1/3 bg-cyan-500 hover:bg-cyan-600 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md text-sm focus:outline-none focus:ring-2 focus:ring-cyan-400" disabled>
            다음 문제
        </button>
    </div>
</div>
<div id="allWordsModal" class="modal">
    <div class="modal-content">
        <div class="flex justify-between items-center pb-3 border-b border-gray-200 mb-4">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800">전체 단어 목록</h2>
            <span class="close-button" id="closeAllWordsModalButton">&times;</span>
        </div>

        <div class="mb-3">
            <input type="text" id="wordSearchInput" placeholder="단어, 발음, 뜻으로 검색..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500">
        </div>

        <div class="flex justify-between items-center text-sm text-gray-600 font-medium mb-2 px-2">
            <span id="wordListStats"></span>
        </div>

        <div id="allWordsListEl" class="max-h-[50vh] overflow-y-auto">
        </div>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="closeSettingsModalButton">&times;</span>
        <h2 class="text-xl sm:text-2xl font-bold text-center text-indigo-600 mb-4">설정</h2>

        <div class="app-info text-center mb-6">
            <p class="font-semibold text-lg text-gray-700">일본어 단어 학습</p>
            <p>제작자: 강민수</p>
            <p>버전: 1.0.2</p>
        </div>
        <div class="border-t border-gray-200 my-4"></div>
        <h3 class="text-lg font-semibold text-gray-800 mb-2 text-center">학습 파트 선택</h3>
        <div id="partSelectionContainer" class="flex flex-wrap justify-center gap-2 mb-4">
            <button data-part="part1" class="part-select-button px-3 py-2 text-sm font-semibold rounded-md border">기초 어휘</button>
            <button data-part="part2" class="part-select-button px-3 py-2 text-sm font-semibold rounded-md border">기출 (16-24)</button>
            <button data-part="part3" class="part-select-button px-3 py-2 text-sm font-semibold rounded-md border">기출 (00-15)</button>
            <button data-part="part4" class="part-select-button px-3 py-2 text-sm font-semibold rounded-md border">기출 (90-99)</button>
        </div>

        <button id="toggleKanjiEtymologyInSettingsButton" class="settings-modal-button">
            <i class="fas fa-font"></i> 현재 카드 한자 풀이 보기/숨기기
        </button>
        <button id="shuffleCardsButton" class="settings-modal-button">
            <i class="fas fa-random"></i> 카드 순서 섞기
        </button>
        <button id="resetCardOrderButton" class="settings-modal-button" disabled>
            <i class="fas fa-undo"></i> 카드 순서 원래대로
        </button>

        <button id="openAllWordsListFromSettingsButton" class="settings-modal-button">
            <i class="fas fa-list-ul"></i> 전체 단어 목록 보기
        </button>
        <button id="switchModeInSettingsButton" class="settings-modal-button">
            <i class="fas fa-vial"></i> 학습/테스트 모드 전환
        </button>
    </div>
</div>


<script>

    const allRawData = {
        'part1': `
間   あいだ, 사이
会う  あう, 만나다
青い  あおい, 파랗다
明るい あかるい, 밝다
赤い  あかい, 빨갛다
秋   あき, 가을
空く  あく, 비다
開く  あく, 열리다
開ける あける, 열다
足   あし, 발
朝   あさ, 아침
新しい あたらしい, 새롭다
暑い  あつい, 덥다
暑さ  あつさ, 더위
集まる あつまる, 모이다
兄   あに, 형/오빠
姉   あね, 언니/누나
安心  あんしん, 안심
洗う  あらう, 씻다
歩く  あるく, 걷다
言う  いう, 말하다
以下  いか, 이하
以外  いがい, 이외
意見  いけん, 의견
医者  いしゃ, 의사
以上  いじょう, 이상
一度  いちど, 한 번
一週間 いっしゅうかん, 일주일
以内  いない, 이내
池   いけ, 연못
石   いし, 돌
急ぐ  いそぐ, 서두르다
糸   いと, 실
田舎  いなか, 시골
犬   いぬ, 개
入口  いりぐち, 입구
色   いろ, 색깔
妹   いもうと, 여동생
生まれる    うまれる, 태어나다
歌   うた, 노래
歌う  うたう, 노래를 부르다
写す  うつす, 베끼다, 찍다
海   うみ, 바다
売る  うる, 팔다
売れる うれる, 팔리다, 팔 수 있다
動く  うごく, 움직이다
動きだす    うごきだす, 움직이기 시작하다
運転  うんてん, 운전
運動  うんどう, 운동
映画  えいが, 영화
映画館 えいがかん, 영화관
英語  えいご, 영어
駅   えき, 역
駅員  えきいん, 역무원
描く  えがく, 그리다
営業  えいぎょう, 영업
多い  おおい, 많다
大きさ おおきさ, 크기
起きる おきる, 일어나다
屋上  おくじょう, 옥상
送る  おくる, 보내다
行う  おこなう, 행하다
教える おしえる, 가르치다
押す  おす, 누르다, 밀다
お正月 おしょうがつ, 양력설
音   おと, 소리
弟   おとうと, 남동생
おもちゃ    おもちゃ, 장난감
お茶  おちゃ, 차
お兄さん    おにいさん, 오빠
お姉さん    おねえさん, 언니, 누나
同じだ おなじだ, 같다
重い  おもい, 무겁다
思い出す    おもいだす, 생각나다, 떠올리다
思う  おもう, 생각하다
泳ぐ  およぐ, 헤엄치다
終わる おわる, 끝나다
音楽  おんがく, 음악
親指  おやゆび, 엄지손가락
会社  かいしゃ, 회사
会話  かいわ, 회화
会場  かいじょう, 회장
買う  かう, 사다
帰り  かえり, 돌아옴
帰る  かえる, 돌아가다
顔   かお, 얼굴
火事  かじ, 화재
書き方 かきかた, 쓰는 법
数える かぞえる, 세다
風   かぜ, 바람
貸す  かす, 빌려주다
家族  かぞく, 가족
片付ける    かたづける, 정리하다
方   かた, 분
体   からだ, 몸
借りる かりる, 빌리다
軽い  かるい, 가볍다
川   かわ, 강
代わり かわり, 대신
考える かんがえる, 생각하다
考え方 かんがえかた, 생각하는 방식
漢字  かんじ, 한자
気分  きぶん, 기분
着物  きもの, 일본 옷
教   きょう, 오늘
教室  きょうしつ, 교실
近所  きんじょ, 근처
銀行  ぎんこう, 은행
銀色  ぎんいろ, 은색
空気  くうき, 공기
空港  くうこう, 공항
首   くび, 목
雲   くも, 구름
黒い  くろい, 검다
薬   くすり, 약
区   く, 구
経験  けいけん, 경험
計画  けいかく, 계획
研究  けんきゅう, 연구
研究会 けんきゅうかい, 연구회
県   けん, 현
公園  こうえん, 공원
工事  こうじ, 공사
工場  こうじょう, 공장
工業  こうぎょう, 공업
氷   こおり, 얼음
声   こえ, 목소리
心   こころ, 마음
答える こたえる, 대답하다
小鳥  ことり, 작은 새
今年  ことし, 올해
今度  こんど, 이번, 다음
米   こめ, 쌀
作文  さくぶん, 작문
産業  さんぎょう, 산업
寒い  さむい, 춥다
皿   さら, 접시
仕事  しごと, 일
時代  じだい, 시대
自転車 じてんしゃ, 자전거
自分  じぶん, 자신
辞書  じしょ, 사전
市民  しみん, 시민
死ぬ  しぬ, 죽다
質問  しつもん, 질문
品物  しなもの, 물건
写真  しゃしん, 사진
写真家 しゃしんか, 사진작가
社長  しゃちょう, 사장
十分  じゅうぶん, 충분
出口  でぐち, 출구
出発  しゅっぱつ, 출발
主人  しゅじん, 주인
住所  じゅうしょ, 주소
授業  じゅぎょう, 수업
食事  しょくじ, 식사
食堂  しょくどう, 식당
食料品 しょくりょうひん, 식료품
調べる しらべる, 조사하다
知る  しる, 알다
白い  しろい, 하얗다
進む  すすむ, 나아가다, 진행되다
好きだ すきだ, 좋아하다
少し  すこし, 조금
住む  すむ, 살다
水道  すいどう, 수도
世界  せかい, 세계
生産  せいさん, 생산
西洋  せいよう, 서양
説明  せつめい, 설명
世話  せわ, 보살핌, 도와줌
席   せき, 자리
祖母  そぼ, 조모, 할머니
空   そら, 하늘
大使  たいし, 대사
大使館 たいしかん, 대사관
大切だ たいせつだ, 소중하다
台所  だいどころ, 부엌
台風  たいふう, 태풍
正しい ただしい, 바르다, 옳다
立つ  たつ, 서다
建物  たてもの, 건물
楽しい たのしい, 즐겁다
足りない    たりない, 부족하다
足りる たりる, 충분하다
茶色  ちゃいろ, 갈색
地下鉄 ちかてつ, 지하철
力   ちから, 힘
地図  ちず, 지도
注意  ちゅうい, 주의
中止  ちゅうし, 중지
地理  ちり, 지리
使う  つかう, 사용하다
着く  つく, 도착하다
机   つくえ, 책상
作る  つくる, 만들다
都合  つごう, 사정, 형편
強い  つよい, 강하다
手紙  てがみ, 편지
店   みせ, 가게
店員  てんいん, 점원
電話代 でんわだい, 전화요금
動物  どうぶつ, 동물
～度  ～ど, ~번
特に  とくに, 특히
特別だ とくべつだ, 특별하다
図書館 としょかん, 도서관
止まる とまる, 멈추다
鳥   とり, 새
遠い  とおい, 멀다
遠く  とおく, 멀리
通る  とおる, 지나가다
土曜日 どようび, 토요일
夏   なつ, 여름
何枚  なんまい, 몇 매, 몇 장
習う  ならう, 배우다
日記  にっき, 일기
二台  にだい, 2대, 두 대
入院  にゅういん, 입원
眠い  ねむい, 졸리다
眠る  ねむる, 자다
乗る  のる, 타다
荷物  にもつ, 짐
飲む  のむ, 마시다
売店  ばいてん, 매점
運ぶ  はこぶ, 운반하다, 옮기다
始める はじめる, 시작하다
場所  ばしょ, 장소
走る  はしる, 달리다
働く  はたらく, 일하다
発音  はつおん, 발음
花   はな, 꽃
春   はる, 봄
早く  はやく, 일찍, 빨리
林   はやし, 숲
光   ひかり, 빛
光る  ひかる, 빛나다
低い  ひくい, 낮다
引く  ひく, 끌다, 찾다
病院  びょういん, 병원
昼   ひる, 낮
昼ごはん    ひるごはん, 점심밥
昼休み ひるやすみ, 점심시간
広い  ひろい, 넓다
服   ふく, 옷
不便だ ふべんだ, 불편하다
船   ふね, 배
冬   ふゆ, 겨울
古い  ふるい, 오래된, 낡다
文   ぶん, 문장, 글
文学  ぶんがく, 문학
便利だ べんりだ, 편리하다
勉強  べんきょう, 공부
本屋  ほんや, 서점
毎朝  まいあさ, 매일 아침
町   まち, 시내, 도시
待つ  まつ, 기다리다
間に合う    まにあう, 시간에 맞추다
短い  みじかい, 짧다
港   みなと, 항구
村   むら, 마을
目   め, 눈
持つ  もつ, 들다, 가지다
持てる もてる, 들 수 있다
森   もり, 숲
問題  もんだい, 문제
門   もん, 문
野菜  やさい, 채소
役   やく, 역할
安い  やすい, 싸다
山道  やまみち, 산길
夕方  ゆうがた, 저녁때
夕飯  ゆうはん, 저녁밥
有名だ ゆうめいだ, 유명하다
雪   ゆき, 눈
用事  ようじ, 볼일, 용무
洋服  ようふく, 양복, 옷
予習  よしゅう, 예습
予定  よてい, 예정
予報  よほう, 예보
夜   よる, 밤
弱い  よわい, 약하다
来週  らいしゅう, 다음 주
料理  りょうり, 요리
旅行  りょこう, 여행
旅館  りょかん, 여관
利用  りよう, 이용
別れる わかれる, 헤어지다
悪い  わるい, 나쁘다
私   わたくし, 저
`,
        'part2': `
            浅い  あさい, 얕다
            案内  あんない, 안내
            意見  いけん, 의견
            薄い  うすい, 얇다
            打つ  うつ, 치다
            覚える おぼえる, 외우다
            お礼  おれい, 사례
            硬い  かたい, 단단하다
            片付ける かたづける, 치우다
            決める きめる, 정하다
            経験  けいけん, 경험
            細かい こまかい, 잘다, 미세하다
            怖い  こわい, 무섭다
            探す  さがす, 찾다
            寂しい さびしい, 외롭다
            残念だ ざんねんだ, 유감이다
            十分  じゅうぶん, 충분
            将来  しょうらい, 장래
            進む  すすむ, 나아가다
            説明  せつめい, 설명
            育てる そだてる, 키우다
            大事だ だいじだ, 소중하다
            足りない たりない, 부족하다
            続く  つづく, 계속되다
            手伝う てつだう, 돕다
            届く  とどく, 도착하다
            取り替える とりかえる, 교환하다
            直る  なおる, 고쳐지다
            苦い  にがい, 쓰다
            残る  のこる, 남다
            乗り換える のりかえる, 갈아타다
            はさみ  はさみ, 가위
            貼る  はる, 붙이다
            深い  ふかい, 깊다
            翻訳  ほんやく, 번역
            負ける まける, 지다
            メニュー  メニュー, 메뉴
            約束  やくそく, 약속
            喜ぶ  よろこぶ, 기뻐하다
            理由  りゆう, 이유
            留守  るす, 부재중
            割れる われる, 깨지다
            アンケート アンケート, 설문조사
            安全だ あんぜんだ, 안전하다
            以上  いじょう, 이상
            受付  うけつけ, 접수
            営業  えいぎょう, 영업
            落とす おとす, 떨어뜨리다
            お土産 おみやげ, 선물
            折る  おる, 접다, 부러뜨리다
            形   かたち, 모양
            カッター  カッター, 커터
            厳しい きびしい, 엄하다
            急行  きゅうこう, 급행
            比べる くらべる, 비교하다
            結果  けっか, 결과
            故障  こしょう, 고장
            込む  こむ, 붐비다
            誘う  さそう, 권유하다
            叱る  しかる, 꾸짖다
            自由に じゆうに, 자유롭게
            種類  しゅるい, 종류
            招待  しょうたい, 초대
            心配  しんぱい, 걱정
            過ぎる すぎる, 지나다
            捨てる すてる, 버리다

            ぜひ  ぜひ, 꼭
            世話  せわ, 돌봄
            戦争  せんそう, 전쟁
            頼む  たのむ, 부탁하다
            チェック  チェック, 체크
            注意  ちゅうい, 주의
            貯金  ちょきん, 저금
            都合  つごう, 형편
            問い合わせ といあわせ, 문의
            とうとう とうとう, 드디어
            泊まる とまる, 묵다
            どんどん どんどん, 점점
            慣れる なれる, 익숙해지다
            値段  ねだん, 가격
            願い  ねがい, 소원
            喉   のど, 목
            はっきり はっきり, 확실히
            復習  ふくしゅう, 복습
            必要だ ひつようだ, 필요하다
            ポスター  ポスター, 포스터
            見つかる みつかる, 발견되다
            珍しい めずらしい, 드물다
            夢   ゆめ, 꿈
            予約  よやく, 예약
            利用  りよう, 이용
            冷房  れいぼう, 냉방
            レンジ  レンジ, 레인지
        `,
        'part3': `
            アルバイト  アルバイト, 아르바이트
            案内  あんない, 안내
            安全だ あんぜんだ, 안전하다
            以下  いか, 이하
            以上  いじょう, 이상
            一見  いっけん, 한 번 봄
            行ってまいります いってまいります, 다녀오겠습니다
            植える うえる, 심다
            打つ  うつ, 치다, 때리다
            腕   うで, 팔
            うるさい うるさい, 시끄럽다
            お祝い おいわい, 축하(선물)
            屋上  おくじょう, 옥상
            遅れる おくれる, 늦다
            お大事に おだいじに, 몸조리 잘 하세요
            おつり おつり, 거스름돈
            お土産 おみやげ, 선물
            おもちゃ おもちゃ, 장난감
            親   おや, 부모
            折れる おれる, 부러지다
            会場  かいじょう, 회장
            鏡   かがみ, 거울
            飾る  かざる, 장식하다
            硬い  かたい, 딱딱하다
            壁   かべ, 벽
            構う  かまう, 상관하다
            関係  かんけい, 관계
            乾く  かわく, 마르다
            機会  きかい, 기회
            危険だ きけんだ, 위험하다
            技術  ぎじゅつ, 기술
            気分  きぶん, 기분
            競争  きょうそう, 경쟁
            興味  きょうみ, 흥미
            比べる くらべる, 비교하다
            ゲーム  ゲーム, 게임
            郊外  こうがい, 교외
            けんか けんか, 싸움
            心   こころ, 마음
            細かい こまかい, 작다, 자세하다
            怖い  こわい, 무섭다
            探す  さがす, 찾다
            差す  さす, (우산을) 쓰다
            さっき さっき, 아까
            触る  さわる, 만지다
            残念だ ざんねんだ, 유감이다
            叱られる しかられる, 꾸중을 듣다
            失敗  しっぱい, 실패
            失礼だ しつれいだ, 실례이다
            調べる しらべる, 조사하다
            邪魔  じゃま, 방해
            邪魔になる じゃまになる, 방해가 되다
            習慣  しゅうかん, 습관
            十分だ じゅうぶんだ, 충분하다
            準備  じゅんび, 준비
            招待  しょうたい, 초대
            将来  しょうらい, 장래
            スイッチ スイッチ, 스위치
            生産  せいさん, 생산
            成績  せいせき, 성적
            世話  せわ, 돌봄
            それに それに, 게다가
            相談する そうだんする, 상담하다
            そろそろ そろそろ, 슬슬
            大事だ だいじだ, 소중하다, 중요하다
            高い  たかい, 높다, 비싸다
            だから だから, 그러니까
            確かだ たしかだ, 확실하다
            出す  だす, 내다
            足す  たす, 더하다
            足りない たりない, 부족하다
            暖房  だんぼう, 난방
            チケット チケット, 티켓
            チャンス チャンス, 찬스
            中止  ちゅうし, 중지
            貯金  ちょきん, 저금
            伝える つたえる, 전하다
            止める とめる, 멈추다, 세우다
            とうとう とうとう, 드디어
            直す  なおす, 고치다
            なるべく なるべく, 되도록
            苦い  にがい, 쓰다
            におい におい, 냄새
            熱心だ ねっしんだ, 열심이다
            寝坊  ねぼう, 늦잠
            眠い  ねむい, 졸리다
            喉   のど, 목
            運ぶ  はこぶ, 옮기다, 나르다
            恥ずかしい はずかしい, 부끄럽다
            パソコン パソコン, 컴퓨터
            番組  ばんぐみ, 방송 프로그램
            パートタイム パートタイム, 파트타임
            引き出し ひきだし, 서랍
            拾う  ひろう, 줍다
            深い  ふかい, 깊다
            増える ふえる, 늘다, 증가하다
            複雑  ふくざつ, 복잡
            踏まれる ふまれる, 밟히다
            放送  ほうそう, 방송
            または または, 또는
            まっすぐ まっすぐ, 똑바로
            見つかる みつかる, 발견되다
            迎える むかえる, 맞이하다
            珍しい めずらしい, 드물다, 희귀하다
            役に立つ やくにたつ, 도움이 되다
            約束  やくそく, 약속
            やっと やっと, 겨우, 드디어
            やっぱり やっぱり, 역시
            柔らかい やわらかい, 부드럽다
            用意  ようい, 준비
            予約  よやく, 예약
            寄る  よる, 들르다
            来週  らいしゅう, 다음 주
            利用  りよう, 이용
            理由  りゆう, 이유
            ルール  ルール, 룰, 규칙
            レジ  レジ, 계산대
            レポート レポート, 리포트
            連絡  れんらく, 연락
        `,
        'part4': `
            あいさつ あいさつ, 인사
            甘い  あまい, 달다
            謝る  あやまる, 사과하다
            うち  うち, 우리, 집
            エレベーター エレベーター, 엘리베이터
            おかげさまで おかげさまで, 덕분에요
            お見舞い おみまい, 병문안
            お礼  おれい, 사례
            掛ける かける, 걸다
            悲しい かなしい, 슬프다
            借りる かりる, 빌리다
            厳しい きびしい, 엄하다
            季節  きせつ, 계절
            けがをする けがをする, 다치다
            故障する こしょうする, 고장나다
            怖い  こわい, 무섭다
            だんだん だんだん, 점점
            しばらく しばらく, 잠시
            出席  しゅっせき, 출석
            すべる すべる, 미끄러지다
            ぜひ  ぜひ, 꼭
            そろそろ そろそろ, 슬슬
            大事だ だいじだ, 소중하다
            力   ちから, 힘
            特に  とくに, 특히
            直す  なおす, 고치다
            慣れる なれる, 익숙해지다
            習う  ならう, 배우다
            におい におい, 냄새
            脱ぐ  ぬぐ, 벗다
            乗り換える のりかえる, 갈아타다
            甘い  あまい, 달다
            アルバイト アルバイト, 아르바이트
            一度  いちど, 한번
            うれしい うれしい, 기쁘다
            エスカレーター エスカレーター, 에스컬레이터
            おかえりなさい おかえりなさい, 다녀오셨어요
            教える おしえる, 가르치다
            お土産 おみやげ, 선물
            ガソリンスタンド ガソリンスタンド, 주유소
            必ず  かならず, 반드시
            かぜをひく かぜをひく, 감기에 걸리다
            危険だ きけんだ, 위험하다
            規則  きそく, 규칙
            くださる くださる, 주시다
            声   こえ, 목소리
            こちらこそ こちらこそ, 저야말로
            サンダル サンダル, 샌들
            したい したい, 하고 싶다
            十分だ じゅうぶんだ, 충분하다
            心配だ しんぱいだ, 걱정이다
            ずっと ずっと, 쭉
            すみ  すみ, 구석
            それでも とでも, 그런데도
            大丈夫だ だいじょうぶだ, 괜찮다
            小さい ちいさい, 작다
            ていねいだ ていねいだ, 정중하다
            なる  なる, 울다
            なるべく なるべく, 되도록
            逃げる にげる, 도망치다
            似る  にる, 닮다
            眠い  ねむい, 졸리다
        `
    };

    let wordData = [];
    let currentPartKey = 'part1'; // 현재 선택된 파트를 추적하는 변수 추가
    let originalWordData = [];
    let isShuffled = false;
    let currentCardIndex = 0;
    let hiraganaVisible = false;
    let meaningVisible = false;
    let kanjiEtymologyVisible = false; // This now acts as a global toggle state
    let memorizedStatus = {};
    let isAutoPlaying = false;
    let speechQueue = [];
    let currentSpeechUtteranceIndex = 0;
    const synth = window.speechSynthesis;
    let voices = [];
    let preferredKoreanVoice = null;
    let preferredJapaneseVoice = null;
    let isTestMode = false;
    let currentTestItemIndex = 0;
    let shuffledTestData = [];
    let score = 0;
    let totalQuestionsInTest = 0;

    // DOM Elements
    const learningModeContainerEl = document.getElementById('learningModeContainer');
    const appTopBarEl = document.getElementById('appTopBar');
    const wordIdEl = document.getElementById('wordIdEl');
    const wordFormEl = document.getElementById('wordFormEl');
    const wordReadingElContainer = document.getElementById('wordReadingElContainer');
    const wordReadingEl = document.getElementById('wordReadingEl');
    const wordMeaningEl = document.getElementById('wordMeaningEl');
    const meaningContainerEl = document.getElementById('meaningContainer');
    const kanjiEtymologyContainerEl = document.getElementById('kanjiEtymologyContainer');
    const kanjiEtymologyEl = document.getElementById('kanjiEtymologyEl');
    const revealHiraganaButton = document.getElementById('revealHiraganaButton');
    const revealMeaningButton = document.getElementById('revealMeaningButton');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const toggleMemorizedButtonEl = document.getElementById('toggleMemorizedButton');
    const playPauseButtonEl = document.getElementById('playPauseButton');
    const settingsButtonEl = document.getElementById('settingsButton');

    const testModeContainerEl = document.getElementById('testModeContainer');
    const testProgressEl = document.getElementById('testProgressEl');
    const testWordFormEl = document.getElementById('testWordFormEl');
    const testChoicesEl = document.getElementById('testChoicesEl');
    const testResultEl = document.getElementById('testResultEl');
    const quitTestButtonEl = document.getElementById('quitTestButton');
    const nextTestItemButtonEl = document.getElementById('nextTestItemButton');

    const allWordsModalEl = document.getElementById('allWordsModal');
    const closeAllWordsModalButtonEl = document.getElementById('closeAllWordsModalButton');
    const allWordsListEl = document.getElementById('allWordsListEl');

    const settingsModalEl = document.getElementById('settingsModal');
    const closeSettingsModalButtonEl = document.getElementById('closeSettingsModalButton');
    const toggleKanjiEtymologyInSettingsButtonEl = document.getElementById('toggleKanjiEtymologyInSettingsButton');
    const shuffleCardsButtonEl = document.getElementById('shuffleCardsButton');
    const resetCardOrderButtonEl = document.getElementById('resetCardOrderButton');
    const openAllWordsListFromSettingsButtonEl = document.getElementById('openAllWordsListFromSettingsButton');
    const switchModeInSettingsButtonEl = document.getElementById('switchModeInSettingsButton');

    const kanjiEtymologies = {
        '間': "門 (문 문) 안에 日 (날 일) 자가 있는 형태로, 문틈으로 해가 비치는 '사이'나 '공간'을 의미합니다.",
        '会': "人 (사람 인) 두 개(亼) 아래에 云 (이를 운) 자가 합쳐진 형태로, 여러 사람이 모여(会) 이야기하는 모습에서 '만나다'라는 뜻이 되었습니다. (会의 약자 형태)",
        '青': "生 (날 생) 위에 丹 (붉을 단: 광물 의미) 자가 있는 형태로, 땅에서 캐낸 푸른빛 광석에서 '푸르다'는 뜻이 유래했습니다. (현대 자형은 主+月과 비슷해 보이나 다릅니다)",
        '明': "日 (해 일)과 月 (달 월)이 합쳐져 해와 달이 모두 떠서 매우 '밝다'는 의미를 나타냅니다.",
        '赤': "大 (큰 대) 자와 火 (불 화) 자의 변형이 합쳐진 형태로, 불(火)이 크게(大) 타는 모습에서 '붉다'는 의미가 나왔습니다.",
        '秋': "禾 (벼 화) 변에 火 (불 화) 자가 합쳐진 형태로, 벼(禾)가 익어 불(火)처럼 붉게 물드는 '가을'을 의미합니다.",
        '空': "穴 (구멍 혈) 아래에 工 (장인 공) 자가 있는 형태로, 장인이 파 놓은 구멍처럼 속이 '비다'라는 의미를 가집니다.",
        '開': "門 (문 문) 안에 干 (방패 간: 빗장 의미) 자가 있는 형태로, 문의 빗장을 열어 '열다', '열리다'는 뜻을 가집니다.",
        '足': "口 (입 구) 아래에 止 (그칠 지) 자의 변형이 있는 형태로, 몸을 지탱하고 멈추게 하는 '발'을 의미합니다.",
        '朝': "十 (열 십) 두 개와 日 (날 일) 그리고 月 (달 월)이 풀(艹) 사이에 있는 형태로, 달(月)이 지고 해(日)가 떠오르는 이른 '아침'을 의미합니다. (원형은 복잡하며 간략화됨)",
        '新': "立 (설 립), 木 (나무 목), 斤 (도끼 근)이 합쳐진 형태로, 나무(木)를 도끼(斤)로 다듬어 새롭게(新) 세운다(立)는 의미입니다.",
        '暑': "日 (날 일) 아래에 者 (사람 자)가 있는 형태로, 해(日) 아래 있는 사람(者)이 '더위'를 느끼는 모습입니다.",
        '集': "隹 (새 추) 세 마리가 木 (나무 목) 위에 '모여 있는' 모습입니다.",
        '兄': "口 (입 구) 위에 儿 (사람 인)이 있는 형태로, 집안에서 입(口)으로 지시하고 이끄는 사람(儿), 즉 '형'을 의미합니다.",
        '姉': "女 (여자 녀) 변에 市 (시장 시, 여기서는 우두머리 의미)가 합쳐진 형태로, 여자(女) 형제 중 위(市)인 사람, 즉 '누나/언니'를 의미합니다.",
        '安': "집(宀) 안에 여자(女)가 있어 '편안하다'는 의미입니다.",
        '心': "심장의 모양을 본뜬 글자입니다.",
        '洗': "氵(물 수) 변에 先 (먼저 선)이 합쳐진 형태로, 물(氵)로 먼저(先) 더러움을 '씻어내다'는 의미입니다.",
        '歩': "止 (그칠 지) 자가 위아래로 있는 형태로, 발자국이 번갈아 찍히며 '걷는' 모양을 나타냅니다.",
        '言': "입에서 말이 나오는 모양을 본뜬 글자입니다.",
        '以': "人 (사람 인) +  丶 (점 주, 어떤 지점). 사람이 어떤 기준점으로부터 시작하여 '~로써' 라는 의미를 나타냅니다.",
        '意': "音 (소리 음) + 心 (마음 심). 마음(心)속의 소리(音), 즉 '뜻'을 의미합니다.",
        '見': "目 (눈 목) + 儿 (사람 인). 사람(儿)이 눈(目)으로 '보다'라는 의미입니다.",
        '医': "匚 (상자 방) + 矢 (화살 시). 상자(匚) 속 화살(矢)처럼 아픈 곳을 고치는 도구나 사람을 의미합니다.",
        '者': "耂 (늙을 로 엄) + 白 (말할 백). 원래는 사탕수수를 삶아 설탕을 만드는 도구를 나타냈으나, 후에 사람을 뜻하게 되었습니다.",
        '一': "가로획 하나로 '하나' 또는 '처음'을 뜻합니다.",
        '週': "辶 (쉬엄쉬엄 갈 착) + 周 (두루 주). 일정한 기간을 두고 한 바퀴 '돌아오다'는 의미입니다.",
        '内': "冂 (멀 경, 경계) + 入 (들 입). 경계 안으로 들어감을 의미합니다.",
        '池': "氵(물 수) + 也 (어조사 야, 여기서는 평평한 땅 의미). 물(氵)이 고여 있는 평평한 곳, '못'을 의미합니다.",
        '石': "언덕(厂) 아래 돌멩이(口) 모양을 본뜬 글자입니다.",
        '急': "刍 (꼴 추, 여기서는 손 모양) + 心 (마음 심). 손으로 심장을 잡고 있는 듯 '급한' 마음을 나타냅니다.",
        '糸': "누에고치에서 뽑아낸 실타래 모양을 본뜬 글자입니다.",
        '田': "밭의 경계와 두렁을 본뜬 모양입니다.",
        '舎': "亼 (모을 집) + 古 (옛 고)의 변형. 사람들이 모여 사는 '집'을 의미합니다.",
        '犬': "개의 옆모습을 본뜬 글자입니다.",
        '入': "안으로 들어가는 모양, 또는 뾰족한 물건으로 찌르는 모양을 본뜬 글자입니다.",
        '口': "사람의 입 모양을 본뜬 글자입니다.",
        '色': "人 (사람 인) + 巴 (꼬리 파, 여기서는 무릎 꿇은 모습). 사람이 무릎 꿇고 있는 모습에서 얼굴 '빛'을 의미하게 되었습니다.",
        '妹': "女 (여자 녀) + 未 (아닐 미). 아직(未) 다 자라지 않은 여자(女) 아이를 의미합니다.",
        '生': "땅에서 풀이 돋아나는 모양을 본뜬 글자로, '태어나다', '살다'는 뜻을 가집니다.",
        '歌': "哥 (형 가, 발음 역할) + 欠 (하품 흠, 입 벌린 모습). 입을 벌려 부르는 '노래'를 의미합니다.",
        '写': "宀 (집 면) + 与 (줄 여, 여기서는 펼쳐놓은 모습). 집(宀) 안에서 무언가를 펼쳐놓고 '베끼다'는 의미입니다.",
        '海': "氵(물 수) + 每 (매양 매). 매일(每)같이 넓게 펼쳐진 물(氵)을 의미합니다.",
        '売': "士 (선비 사, 여기서는 出(나갈 출)의 변형) + 買 (살 매)의 윗부분. 물건을 내놓아(出) 판다는 의미입니다.",
        '動': "重 (무거울 중) + 力 (힘 력). 무거운(重) 것을 힘(力)으로 '움직이다'는 의미입니다.",
        '運': "辶 (쉬엄쉬엄 갈 착) + 軍 (군사 군). 군대가 이동하듯 '옮기다'는 의미입니다.",
        '転': "車 (수레 차) + 云 (이를 운, 회전 의미). 수레(車)가 '구르다'(転)는 의미입니다.",
        '映': "日 (날 일) +央 (가운데 앙). 해(日)가 중앙(央)에서 '비추다'는 의미입니다.",
        '画': "붓(聿)으로 밭(田)의 경계를 '그리다'는 의미입니다.",
        '館': "食 (밥 식) + 官 (벼슬 관). 손님에게 음식을 제공하며 머무르게 하는 '집'을 의미합니다.",
        '英': "풀(艹) 가운데서 가장 뛰어난(央) 꽃. '뛰어나다', '꽃부리'를 의미합니다.",
        '語': "言 (말씀 언) + 吾 (나 오). 내가(吾) 하는 말(言)을 의미합니다.",
        '駅': "馬 (말 마) + 尺 (자 척, 여기서는 사람 의미). 옛날 말을 갈아타던 곳을 의미합니다.",
        '員': "口 (입 구) + 貝 (조개 패, 돈). 돈(貝)을 받고 일하는 사람(口)을 의미합니다.",
        '描': "扌(손 수) +苗 (모 묘). 손(扌)으로 모(苗)를 심듯 정성껏 '그리다'는 의미입니다.",
        '営': "熒(등불 형의 생략형) + 宮(집 궁). 집(宮)에 등불(熒)을 켜고 일을 '경영하다'는 의미입니다.",
        '業': "악기를 세워 놓은 모양, 또는 여러 사람이 힘을 합쳐 일하는 판자. '일', '직업'을 의미합니다.",
        '多': "夕 (저녁 석) 두 개. 저녁(夕)에 또 저녁(夕)이니 시간이 '많다'는 의미에서 '많다'로 발전했습니다.",
        '大': "사람이 팔다리를 크게 벌리고 서 있는 모습을 본뜬 글자로, '크다'는 뜻입니다.",
        '起': "走 (달릴 주) + 己 (몸 기). 몸(己)을 일으켜 달려갈(走) 준비를 한다는 의미입니다.",
        '屋': "尸 (주검 시, 여기서는 지붕 의미) + 至 (이를 지). 지붕(尸)이 있는 곳(至), 즉 '집'을 의미합니다.",
        '上': "기준선 위에 점이나 짧은 선을 그어 '위'를 나타냅니다.",
        '送': "辶 (쉬엄쉬엄 갈 착) + 关 (빗장 관의 생략형, 여기서는 불꽃 의미). 횃불을 들고 사람을 바래다 '보내다'는 의미입니다.",
        '行': "네거리 모양을 본뜬 글자로, '가다', '하다'는 뜻을 가집니다.",
        '教': "孝 (효도 효) + 攵 (칠 복). 효도(孝)의 중요성을 회초리(攵)로 '가르치다'는 의미입니다.",
        '押': "扌(손 수) + 甲 (갑옷 갑). 손(扌)으로 갑옷(甲)처럼 단단한 것을 '누르다'는 의미입니다.",
        '正': "一 (한 일) + 止 (그칠 지). 한(一) 곳에 머물러(止) '바르다', '정하다'는 의미입니다.",
        '月': "초승달 또는 달의 모양을 본뜬 글자입니다.",
        '音': "言 (말씀 언) 안에 점(·) 하나. 입에서 나오는 말(言)의 가장 기본적인 단위, '소리'를 의미합니다.",
        '弟': "활(弓)을 여러 번 묶은(丿) 실(丨) 모양. 형을 따르는 '아우'를 의미합니다.",
        '茶': "풀(艹) + 余 (나 여, 여기서는 나무 목(木)과 비슷한 의미). 차나무(木)의 잎(艹)을 의미합니다.",
        '同': "冂 (멀 경, 에워싸다) + 一 (한 일) + 口 (입 구). 여러 사람이 한(一) 입(口)으로 같은 말을 하거나, 한곳에 모인다는 의미입니다.",
        '重': "千 (일천 천) + 東 (동녘 동)의 변형으로 보기도 하고, 사람이 무거운 짐을 진 모습으로 보기도 합니다.",
        '思': "田 (밭 전, 여기서는 머리) + 心 (마음 심). 머리(田)와 마음(心)으로 '생각하다'는 의미입니다.",
        '泳': "氵(물 수) + 永 (길 영). 물(氵) 속에서 길게(永) 나아가며 '헤엄치다'는 의미입니다.",
        '終': "糸 (실 사) + 冬 (겨울 동). 겨울(冬)이 되면 실(糸)을 감아 일을 '마치다'는 의미입니다.",
        '楽': "나무(木) 위에 악기(白+幺)를 놓고 즐긴다는 의미입니다. '즐거울 락', '풍류 악'.",
        '親': "立 (설 립) + 木 (나무 목) + 見 (볼 견). 나무(木) 위에 올라가 멀리까지 살펴(見)보는 '부모'를 의미합니다.",
        '指': "扌(손 수) + 旨 (뜻 지). 손(扌)으로 가리키며 뜻(旨)을 전하는 '손가락'을 의미합니다.",
        '社': "示 (보일 시, 제단) + 土 (흙 토). 토지신에게 제사를 지내기 위해 사람들이 '모이는' 곳, 또는 '단체'를 의미합니다.",
        '話': "言 (말씀 언) + 舌 (혀 설). 혀(舌)로 하는 말(言)을 의미합니다.",
        '場': "土 (흙 토) + 昜 (볕 양, 발음 역할). 햇볕(昜)이 드는 평평한 땅(土), '장소'를 의미합니다.",
        '買': "网 (그물 망) + 貝 (조개 패, 돈). 그물(网)로 조개(貝, 돈)를 모아 물건을 '사다'는 의미입니다.",
        '帰': "帚 (비 추) + 止 (그칠 지) + 阜 (언덕 부, 좌부변). 집으로 돌아간다는 의미입니다. (원형 복잡)",
        '顔': "彦 (선비 언, 얼굴 모양) + 頁 (머리 혈). 얼굴(彦)과 머리(頁)를 합쳐 '얼굴'을 의미합니다.",
        '火': "불이 타오르는 모양을 본뜬 글자입니다.",
        '事': "깃발을 손에 들고 일을 하는 모양에서 '일'을 의미합니다.",
        '書': "聿 (붓 율) + 曰 (가로 왈, 말하다). 붓(聿)으로 말을 '쓰다'는 의미입니다.",
        '数': "米 (쌀 미) + 攵 (칠 복) + 婁 (끌 루, 발음). 쌀알을 세듯이 수를 '세다'는 의미입니다.",
        '風': "凡 (무릇 범, 바람의 소리/돛) + 虫 (벌레 충). 바람에 날리는 벌레 또는 바람 그 자체를 의미합니다.",
        '貸': "代 (대신할 대) + 貝 (조개 패, 돈). 돈(貝)을 대신(代) 빌려준다는 의미입니다.",
        '家': "宀 (집 면) + 豕 (돼지 시). 집(宀) 안에 돼지(豕)를 기르던 모습에서 '집'을 의미합니다.",
        '族': "方 (깃발 방) + 矢 (화살 시). 깃발(方) 아래 모인 같은 혈족(矢)을 의미합니다.",
        '片': "나무(木)를 반으로 쪼갠 왼쪽 부분을 나타내며, '조각', '한쪽'을 의미합니다.",
        '方': "쟁기 모양 또는 사람이 깃발을 들고 있는 모습에서 '방향', '방법'을 의미합니다.",
        '体': "骨 (뼈 골) + 豊 (풍년 풍, 발음). 몸의 뼈대(骨)를 의미합니다. (人 + 本 으로도 해석)",
        '借': "亻(사람 인) + 昔 (옛 석). 옛날(昔)부터 사람(亻)들 사이에 물건을 '빌리다'는 의미입니다.",
        '軽': "車 (수레 차) + 巠 (물줄기 경, 발음). 수레(車)가 가볍게 지나간다는 의미입니다.",
        '川': "물이 흘러가는 모양을 본뜬 글자입니다.",
        '代': "亻(사람 인) + 弋 (주살 익). 사람(亻)이 차례를 '대신하다'는 의미입니다.",
        '考': "老 (늙을 로)의 생략형 + 丂 (숨막힐 규, 소리). 늙은이(老)가 숨을 고르며 깊이 '생각하다'는 의미입니다.",
        '漢': "氵(물 수) + 堇 (진흙 근, 발음) + 夫 (지아비 부)의 변형. 한수(漢水) 또는 한나라를 의미합니다.",
        '字': "宀 (집 면) + 子 (아들 자). 집(宀) 안에서 아이(子)가 글자를 배우는 모습에서 '글자'를 의미합니다.",
        '気': "气 (기운 기) + 米 (쌀 미). 쌀(米)을 쪄서 나오는 수증기(气)에서 '기운'을 의미합니다.",
        '分': "八 (여덟 팔, 나누다) + 刀 (칼 도). 칼(刀)로 '나누다'(八)는 의미입니다.",
        '着': "羊 (양 양) + 目 (눈 목) 아래. 양(羊)의 눈(目)처럼 옷이 몸에 잘 '붙다', '입다'는 의미입니다.",
        '物': "牛 (소 우) + 勿 (말 물, 여러 색깔). 여러 색깔(勿)의 소(牛)처럼 다양한 '물건'을 의미합니다.",
        '今': "亼 (모을 집) + ㇇ (숨을 은). 사람들이 모여있는 '지금'을 의미합니다.",
        '室': "宀 (집 면) + 至 (이를 지). 사람(至)이 사는 집(宀), '방'을 의미합니다.",
        '近': "辶 (쉬엄쉬엄 갈 착) + 斤 (도끼 근). 도끼(斤)를 들고 가까이(辶) 간다는 의미입니다.",
        '所': "戸 (지게 호) + 斤 (도끼 근). 도끼(斤)로 나무를 찍어 집(戸)을 짓는 '장소'를 의미합니다.",
        '銀': "金 (쇠 금) + 艮 (어긋날 간, 발음). 은색(艮) 빛깔의 쇠(金)를 의미합니다.",
        '行': "네거리 모양을 본뜬 글자로, '가다', '하다'는 뜻을 가집니다.", // 은행의 行
        '港': "氵(물 수) + 巷 (거리 항, 발음). 물가(氵)에 있는 배 대는 곳(巷), '항구'를 의미합니다.",
        '首': "머리카락과 눈이 있는 머리 모양을 본뜬 글자입니다.",
        '雲': "雨 (비 우) + 云 (이를 운, 구름 모양). 비(雨)를 머금은 구름(云)을 의미합니다.",
        '黒': "炎 (불꽃 염) 위에 창문(囱)이 있고, 그을음이 낀 모습에서 '검다'는 의미가 나왔습니다.",
        '薬': "艹 (풀 초) + 楽 (즐거울 락, 여기서는 약초 의미). 즐거움(楽)을 주는 풀(艹), 즉 '약'을 의미합니다.",
        '区': "匚 (상자 방) + 品 (물건 품). 물건(品)을 상자(匚)에 나누어 담아 '구분하다'는 의미입니다.",
        '経': "糸 (실 사) + 巠 (물줄기 경). 베틀의 날실(糸)처럼 세로로 곧게 뻗어 '지나다', '경험'을 의미합니다.",
        '験': "馬 (말 마) + 僉 (다 첨, 모두). 모든(僉) 말(馬)을 '시험하다'는 의미입니다.",
        '計': "言 (말씀 언) + 十 (열 십). 말(言)로 열(十)까지 헤아려 '계산하다', '계획하다'는 의미입니다.",
        '画': "붓(聿)으로 밭(田)의 경계를 '그리다'는 의미입니다.", // 계획의 画
        '研': "石 (돌 석) + 开 (평평할 견, 발음). 돌(石)을 갈아(开) '연구하다'는 의미입니다.",
        '究': "穴 (구멍 혈) + 九 (아홉 구). 구멍(穴) 속을 아홉(九) 번이나 파고들어 '궁구하다'는 의미입니다.",
        '会': "人 (사람 인) 두 개(亼) 아래에 云 (이를 운) 자가 합쳐진 형태로, 여러 사람이 모여(会) 이야기하는 모습에서 '만나다'라는 뜻이 되었습니다. (会의 약자 형태)", // 연구회의 会
        '県': "目 (눈 목) + 系 (이을 계)의 변형. 눈(目)으로 직접 매달아(系) 다스리는 '현'을 의미합니다.",
        '公': "八 (여덟 팔, 나누다) + 厶 (사사 사). 사사로운(厶) 것을 나누어(八) '공평하게 하다'는 의미입니다.",
        '園': "囗 (에워쌀 위) +袁 (옷 길 원). 담(囗)으로 둘러싸인 동산(袁)을 의미합니다.",
        '工': "장인이 쓰는 도구 모양을 본뜬 글자로, '만들다', '일'을 의미합니다.",
        '事': "깃발을 손에 들고 일을 하는 모양에서 '일'을 의미합니다.", // 공사의 事
        '場': "土 (흙 토) + 昜 (볕 양, 발음 역할). 햇볕(昜)이 드는 평평한 땅(土), '장소'를 의미합니다.", // 공장의 場
        '業': "악기를 세워 놓은 모양, 또는 여러 사람이 힘을 합쳐 일하는 판자. '일', '산업'을 의미합니다.", // 공업의 業
        '氷': "水 (물 수) + 丶 (점 주, 얼음의 결정). 물(水)이 얼어(丶) 생긴 '얼음'을 의미합니다.",
        '声': "士 (선비 사, 악기) + 殳 (칠 수) + 耳 (귀 이). 악기(士)를 쳐서(殳) 귀(耳)에 들리는 '소리'를 의미합니다.",
        '答': "竹 (대 죽) + 合 (합할 합). 대나무(竹)로 만든 서판에 글을 써서 질문에 '대답하다'는 의미입니다.",
        '小': "갈고리 세 개가 아래로 향한 모양으로, '작다'는 뜻입니다.",
        '鳥': "새의 모양을 본뜬 글자입니다.",
        '年': "禾 (벼 화) + 人 (사람 인) 또는 千 (일천 천). 사람이(人) 벼(禾)를 수확하는 주기, 즉 '해'를 의미합니다.",
        '度': "庶 (여러 서)의 생략 + 右 (오른손 우). 손(又)으로 헤아려 '정도', '횟수'를 의미합니다.",
        '米': "벼 이삭에 낟알이 달린 모양을 본뜬 글자로, '쌀'을 의미합니다.",
        '作': "亻(사람 인) + 乍 (잠깐 사). 사람(亻)이 잠깐(乍) 사이에 무언가를 '만들다'는 의미입니다.",
        '文': "가슴에 새긴 문신 모양에서 '글월', '무늬'를 의미합니다.",
        '産': "立 (설 립) + 生 (날 생). 아이를 낳아(生) 세우듯(立) '생산하다'는 의미입니다.",
        '業': "악기를 세워 놓은 모양, 또는 여러 사람이 힘을 합쳐 일하는 판자. '일', '산업'을 의미합니다.", // 산업의 業
        '寒': "宀 (집 면) + 冫 (얼음 빙) + (사람과 풀). 집(宀) 안에서 사람이 추위(冫)에 떠는 모습을 나타냅니다.",
        '皿': "음식을 담는 접시 모양을 본뜬 글자입니다.",
        '仕': "亻(사람 인) + 士 (선비 사). 사람(亻)이 선비(士)처럼 일을 '섬기다'는 의미입니다.",
        '時': "日 (날 일) + 寺 (절 사, 발음). 해(日)의 움직임으로 정해지는 '때', '시간'을 의미합니다.",
        '代': "亻(사람 인) + 弋 (주살 익). 사람(亻)이 차례를 '대신하다'는 의미입니다.", // 시대의 代
        '自': "코 모양을 본뜬 글자로, '스스로'라는 뜻입니다.",
        '転': "車 (수레 차) + 云 (이를 운, 회전 의미). 수레(車)가 '구르다'(転)는 의미입니다.", // 자전거의 転
        '車': "수레바퀴 두 개와 몸통을 그린 모양입니다.", // 자전거의 車
        '分': "八 (여덟 팔, 나누다) + 刀 (칼 도). 칼(刀)로 '나누다'(八)는 의미입니다.", // 자신의 分
        '辞': "辛 (매울 신, 죄인) + 舌 (혀 설). 죄인(辛)이 혀(舌)로 변명하며 '말하다', '사양하다'는 의미입니다.",
        '書': "聿 (붓 율) + 曰 (가로 왈, 말하다). 붓(聿)으로 말을 '쓰다'는 의미입니다.", // 사전의 書
        '市': "亠 (머리 두) + 巾 (수건 건). 시장에 물건(巾)을 벌여놓은(亠) 모습을 나타냅니다.",
        '民': "눈을 찔러 멀게 한 노예의 모습에서 '백성'을 의미하게 되었습니다.",
        '死': "歹 (뼈앙상할 알, 부서진 뼈) + 人 (사람 인). 사람(人)이 죽어 뼈만(歹) 남는다는 의미입니다.",
        '質': "斤 (도끼 근) 두 개 + 貝 (조개 패, 돈). 도끼(斤)로 물건의 바탕을 따져 돈(貝)의 가치를 매기다, '바탕', '묻다'는 의미입니다.",
        '問': "門 (문 문) + 口 (입 구). 문(門) 앞에서 입(口)으로 '묻다'는 의미입니다.",
        '品': "口 (입 구) 세 개. 여러 물건(口)을 쌓아놓은 모양에서 '물건'을 의미합니다.",
        '真': "匕 (비수 비, 사람) + 目 (눈 목) + 鼎 (솥 정)의 일부. 사람이(匕) 눈(目)으로 솥(鼎)의 참된 모습을 본다는 의미에서 '참되다'입니다.",
        '写': "宀 (집 면) + 与 (줄 여, 여기서는 펼쳐놓은 모습). 집(宀) 안에서 무언가를 펼쳐놓고 '베끼다'는 의미입니다.", // 사진의 写
        '長': "머리카락이 긴 노인의 모습을 본뜬 글자로, '길다', '어른', '우두머리'를 의미합니다.",
        '出': "발(止)이 문지방(凵)을 넘어 나가는 모습에서 '나가다'를 의미합니다.",
        '発': "癶 (필 발머리, 발) + 弓 (활 궁) + 殳 (칠 수). 활(弓)을 쏘아(殳) 화살이 나아가듯(癶) '쏘다', '일어나다'는 의미입니다.",
        '主': "등잔(丶)과 심지(王) 모양에서 '주인', '임금'을 의미합니다.",
        '人': "사람이 서 있는 옆모습을 본뜬 글자입니다.",
        '住': "亻(사람 인) + 主 (주인 주). 사람(亻)이 주인(主)이 되어 '살다'는 의미입니다.",
        '所': "戸 (지게 호) + 斤 (도끼 근). 도끼(斤)로 나무를 찍어 집(戸)을 짓는 '장소'를 의미합니다.", // 주소의 所
        '授': "扌(손 수) + 受 (받을 수). 손(扌)으로 건네주어(受) '주다', '가르치다'는 의미입니다.",
        '業': "악기를 세워 놓은 모양, 또는 여러 사람이 힘을 합쳐 일하는 판자. '일', '산업'을 의미합니다.", // 수업의 業
        '食': "亼 (모을 집, 뚜껑) + 良 (좋을 량, 음식). 뚜껑(亼) 덮인 그릇 안의 좋은(良) 음식에서 '먹다'는 의미입니다.",
        '堂': "土 (흙 토) + 尚 (오히려 상, 높다). 흙(土)을 높이(尚) 쌓아 올린 '집', '당당하다'는 의미입니다.",
        '料': "米 (쌀 미) + 斗 (말 두). 쌀(米)을 말(斗)로 헤아려 '헤아리다', '재료'를 의미합니다.",
        '品': "口 (입 구) 세 개. 여러 물건(口)을 쌓아놓은 모양에서 '물건'을 의미합니다.", // 식료품의 品
        '調': "言 (말씀 언) + 周 (두루 주). 말(言)로 두루(周) 살펴 '고르다', '조사하다'는 의미입니다.",
        '知': "矢 (화살 시) + 口 (입 구). 화살(矢)처럼 빠르게 아는 것을 입(口)으로 말한다는 의미에서 '알다'입니다.",
        '白': "햇빛 또는 쌀알의 모양을 본뜬 글자로, '희다'는 뜻입니다.",
        '進': "辶 (쉬엄쉬엄 갈 착) + 隹 (새 추). 새(隹)가 앞으로 나아가듯(辶) '나아가다'는 의미입니다.",
        '好': "女 (여자 녀) + 子 (아들 자). 여자(女)가 아이(子)를 사랑하듯 '좋아하다'는 의미입니다.",
        '少': "小 (작을 소) + 丿 (삐침 별). 작은(小) 것에서 조금(丿) 더 덜어내 '적다'는 의미입니다.",
        '水': "물이 흘러가는 모양을 본뜬 글자입니다.",
        '道': "辶 (쉬엄쉬엄 갈 착) + 首 (머리 수). 머리(首)를 앞세우고 나아가는(辶) '길'을 의미합니다.",
        '世': "나무(木) 가지가 여러 겹으로 뻗은 모양, 또는 발자국 세 개. '세상', '대'를 의미합니다.",
        '界': "田 (밭 전) + 介 (낄 개). 밭(田) 사이에 끼어(介) 있는 '경계'를 의미합니다.",
        '製': "制 (지을 제) + 衣 (옷 의). 규칙(制)에 맞게 옷(衣)을 '만들다'는 의미입니다.",
        '産': "立 (설 립) + 生 (날 생). 아이를 낳아(生) 세우듯(立) '생산하다'는 의미입니다.", // 생산의 産
        '西': "새가 둥지(冂)에 드는 모습에서 해가 지는 '서쪽'을 의미합니다.",
        '洋': "氵(물 수) + 羊 (양 양). 양(羊)처럼 넓게 펼쳐진 물(氵), '바다'를 의미합니다.",
        '説': "言 (말씀 언) + 兌 (바꿀 태, 기뻐하다). 말(言)로 기쁘게(兌) '설명하다'는 의미입니다.",
        '明': "日 (해 일)과 月 (달 월)이 합쳐져 해와 달이 모두 떠서 매우 '밝다'는 의미를 나타냅니다.", // 설명의 明
        '世話': "世 (세상 세) + 話 (말씀 화). 세상(世) 살아가는 이야기(話)를 나누며 돌보다.", // 世話는 숙어적 표현, 각 한자 풀이는 위에 있음.
        '席': "广 (집 엄) + 巾 (수건 건). 집(广) 안에 깔개(巾)를 펴 놓은 '자리'를 의미합니다.",
        '祖': "示 (보일 시, 제사) + 且 (또 차, 남성 생식기/제기). 제사(示)를 지내는 조상(且)을 의미합니다.",
        '母': "여자(女)가 아이에게 젖을 먹이는 모습에서 '어머니'를 의미합니다.",
        '使': "亻(사람 인) + 吏 (관리 리). 사람(亻)을 관리(吏)로 '부리다'는 의미입니다.",
        '館': "食 (밥 식) + 官 (벼슬 관). 손님에게 음식을 제공하며 머무르게 하는 '집'을 의미합니다.", // 대사관의 館
        '切': "七 (일곱 칠) + 刀 (칼 도). 칼(刀)로 일곱(七) 번 자르듯 '끊다', '간절하다'는 의미입니다.",
        '台': "口 (입 구) + 以 (써 이) 또는 厶 (사사 사). 높은 토대(以) 위에 사람이 말하는(口) '대'를 의미합니다.",
        '所': "戸 (지게 호) + 斤 (도끼 근). 도끼(斤)로 나무를 찍어 집(戸)을 짓는 '장소'를 의미합니다.", // 대소의 所
        '風': "凡 (무릇 범, 바람의 소리/돛) + 虫 (벌레 충). 바람에 날리는 벌레 또는 바람 그 자체를 의미합니다.", // 태풍의 風
        '立': "사람이 땅 위에 서 있는 모습을 본뜬 글자입니다.",
        '建': "廴 (길게 걸을 인) + 聿 (붓 율). 붓(聿)으로 설계하여 길게(廴) '세우다'는 의미입니다.",
        '物': "牛 (소 우) + 勿 (말 물, 여러 색깔). 여러 색깔(勿)의 소(牛)처럼 다양한 '물건'을 의미합니다.", // 건물의 物
        '地': "土 (흙 토) + 也 (어조사 야, 평평하다). 평평한(也) 땅(土)을 의미합니다.",
        '下': "기준선 아래에 점이나 짧은 선을 그어 '아래'를 나타냅니다.",
        '鉄': "金 (쇠 금) + 失 (잃을 실, 발음). 쇠(金)의 한 종류인 '철'을 의미합니다.",
        '力': "팔에 힘줄이 솟은 모양 또는 쟁기 모양을 본뜬 글자로, '힘'을 의미합니다.",
        '図': "囗 (에워쌀 위) + 为 (할 위). 나라(囗)의 일을 계획하여(为) '그리다'는 의미입니다.",
        '注': "氵(물 수) + 主 (주인 주). 물(氵)을 한 곳에 집중하여(主) '붓다', '주의하다'는 의미입니다.",
        '意': "音 (소리 음) + 心 (마음 심). 마음(心)속의 소리(音), 즉 '뜻'을 의미합니다.", // 주의의 意
        '中': "깃발이나 과녁의 한가운데를 나타내며, '가운데'를 의미합니다.",
        '止': "발 모양을 본뜬 글자로, '그치다', '멈추다'는 의미입니다.",
        '理': "王 (구슬 옥) + 里 (마을 리). 구슬(王)의 결(里)을 다듬듯 '다스리다', '이치'를 의미합니다.",
        '机': "木 (나무 목) + 几 (안석 궤). 나무(木)로 만든 책상(几)을 의미합니다.",
        '都': "者 (사람 자) + 邑 (고을 읍, 우부방). 많은 사람(者)이 모여 사는 '도읍'을 의미합니다.",
        '合': "亼 (모을 집) + 口 (입 구). 여러 입(口)이 하나로 모여(亼) '합하다'는 의미입니다.",
        '強': "弓 (활 궁) + 虫 (벌레 충) 또는 口 (입 구). 활(弓)처럼 강한 벌레(虫) 또는 강하게 외치는 입(口)을 의미합니다.",
        '手': "다섯 손가락이 펼쳐진 손 모양을 본뜬 글자입니다.",
        '紙': "糸 (실 사) + 氏 (성씨 씨, 발음). 실(糸)처럼 얇게 만든 '종이'를 의미합니다.",
        '店': "广 (집 엄) + 占 (차지할 점). 물건을 쌓아두고(占) 파는 집(广)을 의미합니다.",
        '電': "雨 (비 우) + 申 (펼 신, 번개). 비(雨) 올 때 번쩍이는(申) '번개'를 의미합니다.",
        '話': "言 (말씀 언) + 舌 (혀 설). 혀(舌)로 하는 말(言)을 의미합니다.", // 전화대의 話
        '代': "亻(사람 인) + 弋 (주살 익). 사람(亻)이 차례를 '대신하다'는 의미입니다.", // 전화대의 代
        '特': "牛 (소 우) + 寺 (절 사). 절(寺)에 바치는 특별한 소(牛)를 의미합니다.",
        '別': "冎 (뼈 과) + 刀 (칼 도). 칼(刀)로 뼈(冎)를 발라내 '나누다', '헤어지다'는 의미입니다.",
        '遠': "辶 (쉬엄쉬엄 갈 착) + 袁 (옷 길 원, 발음). 길게(袁) 가야하는(辶) '먼' 곳을 의미합니다.",
        '通': "辶 (쉬엄쉬엄 갈 착) + 甬 (甬길 용, 꿰뚫다). 길(辶)이 꿰뚫려(甬) '통하다'는 의미합니다.",
        '土': "땅에서 싹이 돋아나는 모양 또는 흙더미를 본뜬 글자로, '흙'을 의미합니다.",
        '曜': "日 (날 일) + 翟 (꿩 적, 빛나다). 해(日)처럼 빛나는(翟) '요일'을 의미합니다.",
        '日': "해의 모양을 본뜬 글자입니다.",
        '夏': "頁 (머리 혈) + 夊 (천천히 걸을 쇠) + 目 (눈 목). 가면(頁)을 쓰고 춤추는(夊) 사람의 모습에서 '여름'을 의미합니다.",
        '何': "亻(사람 인) + 可 (옳을 가). 사람(亻)에게 무엇이 옳은지(可) '묻다'는 의미입니다.",
        '枚': "木 (나무 목) + 攵 (칠 복). 나무(木)를 쳐서(攵) 만든 '얇은 조각', '장'을 의미합니다.",
        '習': "羽 (깃 우) + 白 (흰 백, 여기서는 새끼 새). 새(白)가 날갯짓(羽)을 반복하여 '익히다'는 의미입니다.",
        '記': "言 (말씀 언) + 己 (몸 기). 자기(己)가 한 말(言)을 '기록하다'는 의미입니다.",
        '二': "가로획 두 개로 '둘'을 뜻합니다.",
        '台': "口 (입 구) + 以 (써 이) 또는 厶 (사사 사). 높은 토대(以) 위에 사람이 말하는(口) '대'를 의미합니다.", // 二台의 台
        '入': "안으로 들어가는 모양, 또는 뾰족한 물건으로 찌르는 모양을 본뜬 글자입니다.", // 입원의 入
        '院': "阜 (언덕 부, 좌부변) + 完 (완전할 완). 언덕(阜)에 완전하게(完) 지은 '집', '관청'을 의미합니다.",
        '眠': "目 (눈 목) + 民 (백성 민, 발음). 눈(目)을 감고 '자다'는 의미입니다.",
        '乗': "禾 (벼 화) + 北 (북녘 북, 등지다) + 木 (나무 목). 나무(木) 위에 사람이 올라탄 모습을 나타냅니다.",
        '荷': "艹 (풀 초) + 何 (어찌 하). 풀(艹)로 만든 멜빵으로 짐(何)을 '메다'는 의미입니다.",
        '飲': "食 (밥 식) + 欠 (하품 흠, 입 벌리다). 음식(食)을 입 벌려(欠) '마시다'는 의미입니다.",
        '始': "女 (여자 녀) + 台 (별 태, 처음). 여자(女)가 아이를 처음(台) 낳듯 '시작하다'는 의미입니다.",
        '走': "土 (흙 토, 발) + 止 (그칠 지, 발). 발(土+止)로 '달리다'는 의미입니다. (원형은 大 + 止)",
        '働': "亻(사람 인) + 動 (움직일 동). 사람(亻)이 '움직여(動) 일하다'는 의미입니다.",
        '音': "言 (말씀 언) 안에 점(·) 하나. 입에서 나오는 말(言)의 가장 기본적인 단위, '소리'를 의미합니다.", // 발음의 音
        '花': "艹 (풀 초) + 化 (될 화). 풀(艹)이 변화하여(化) 피는 '꽃'을 의미합니다.",
        '春': "艸 (풀 초) + 日 (날 일) + 屯 (진칠 둔, 싹). 해(日) 아래 풀(艸)과 싹(屯)이 돋는 '봄'을 의미합니다.",
        '早': "日 (날 일) + 甲 (갑옷 갑, 껍질). 해(日)가 막 껍질(甲)을 깨고 나오듯 '이르다'는 의미입니다.",
        '林': "木 (나무 목) 두 개. 나무가 많은 '숲'을 의미합니다.",
        '光': "火 (불 화) 위에 사람(儿)이 있는 모양. 사람(儿) 머리 위에서 불(火)처럼 빛나는 '빛'을 의미합니다.",
        '低': "亻(사람 인) + 氐 (근본 저, 낮다). 사람(亻)의 키가 '낮다'(氐)는 의미입니다.",
        '引': "弓 (활 궁) + 丨 (뚫을 곤, 활시위). 활(弓)시위를 '당기다'는 의미입니다.",
        '病': "疒 (병들어 기댈 녁) + 丙 (남녘 병, 발음). 병(疒)이 들었다는 의미입니다.",
        '院': "阜 (언덕 부, 좌부변) + 完 (완전할 완). 언덕(阜)에 완전하게(完) 지은 '집', '관청'을 의미합니다.", // 병원의 院
        '昼': "尺 (자 척, 사람) + 一 (한 일) + 日 (날 일). 해(日)가 한가운데(一) 떠 있는 '낮'을 의미합니다.",
        '飯': "食 (밥 식) + 反 (돌이킬 반, 발음). 먹는(食) '밥'을 의미합니다.",
        '休': "亻(사람 인) + 木 (나무 목). 사람(亻)이 나무(木) 그늘에서 '쉬다'는 의미입니다.",
        '広': "广 (집 엄) + 黃 (누를 황, 크다). 집(广)이 크고(黃) '넓다'는 의미입니다.",
        '服': "月 (고기 육, 몸) + 卩 (병부 절, 무릎 꿇다) + 又 (또 우, 손). 몸(月)에 맞게 손(又)으로 옷을 입히거나 입는다는(卩) 의미입니다.",
        '不': "새가 하늘로 날아오르지 못하는 모양에서 '아니다'는 뜻이 나왔습니다.",
        '便': "亻(사람 인) + 更 (고칠 경). 사람(亻)이 일을 하기 '편리하다'(更)는 의미입니다.",
        '船': "舟 (배 주) +㕣 (골 연, 발음). 물 위를 가는 배(舟)를 의미합니다.",
        '冬': "夂 (뒤져올 치, 끝) + 冫 (얼음 빙). 한 해의 끝(夂)에 얼음(冫)이 어는 '겨울'을 의미합니다.",
        '古': "十 (열 십) + 口 (입 구). 열(十) 세대를 입(口)으로 전해 내려온 '오래되다'는 의미입니다.",
        '学': "爻 (효 효, 가르침) + 冖 (덮을 멱, 집) + 子 (아들 자). 집(冖)에서 아이(子)가 가르침(爻)을 '배우다'는 의미입니다.",
        '勉': "免 (힘쓸 면) + 力 (힘 력). 힘(力)써 '노력하다'(免)는 의미입니다.",
        '強': "弓 (활 궁) + 虫 (벌레 충) 또는 口 (입 구). 활(弓)처럼 강한 벌레(虫) 또는 강하게 외치는 입(口)을 의미합니다.", // 공부의 強
        '本': "木 (나무 목) + 一 (한 일). 나무(木)의 뿌리(一) 부분, '근본'을 의미합니다.",
        '屋': "尸 (주검 시, 여기서는 지붕 의미) + 至 (이를 지). 지붕(尸)이 있는 곳(至), 즉 '집'을 의미합니다.", // 본屋의 屋
        '毎': "人 (사람 인) + 母 (어미 모). 어머니(母)가 매일(每)같이 아이를 돌본다는 의미입니다.",
        '町': "田 (밭 전) + 丁 (고무래 정, 사람). 밭(田)과 사람(丁)이 사는 '마을'을 의미합니다.",
        '待': "彳(두인변, 가다) + 寺 (절 사, 머무르다). 길(彳)에서 머무르며(寺) '기다리다'는 의미입니다.",
        '短': "矢 (화살 시) + 豆 (콩 두, 제기). 화살(矢)이나 제기(豆)의 다리가 '짧다'는 의미입니다.",
        '港': "氵(물 수) + 巷 (거리 항, 발음). 물가(氵)에 있는 배 대는 곳(巷), '항구'를 의미합니다.", // 항구의 港
        '村': "木 (나무 목) + 寸 (마디 촌, 작다). 나무(木) 옆에 작은(寸) 집들이 모인 '마을'을 의미합니다.",
        '目': "눈의 모양을 본뜬 글자입니다.",
        '持': "扌(손 수) + 寺 (절 사, 유지하다). 손(扌)으로 계속(寺) '가지다'는 의미입니다.",
        '森': "木 (나무 목) 세 개. 나무가 빽빽한 '숲'을 의미합니다.",
        '題': "是 (옳을 시) + 頁 (머리 혈). 머리(頁)로 옳고(是) 그름을 판단하는 '제목', '문제'를 의미합니다.",
        '門': "양쪽 문짝이 있는 대문 모양을 본뜬 글자입니다.",
        '野': "里 (마을 리) + 予 (줄 여, 나). 마을(里) 밖의 나(予)의 땅, '들'을 의미합니다.",
        '菜': "艹 (풀 초) + 采 (캘 채). 풀(艹) 중에서 먹을 것을 '캐다'(采), '나물'.",
        '役': "彳(두인변, 가다) + 殳 (칠 수). 사람을 보내(彳) 일을 시키거나(殳) '부리다'는 의미입니다.",
        '山': "산봉우리 세 개가 이어진 모양을 본뜬 글자입니다.",
        '道': "辶 (쉬엄쉬엄 갈 착) + 首 (머리 수). 머리(首)를 앞세우고 나아가는(辶) '길'을 의미합니다.", // 산길의 道
        '夕': "달이 막 뜨기 시작한 저녁 하늘 모양을 본뜬 글자입니다.",
        '飯': "食 (밥 식) + 反 (돌이킬 반, 발음). 먹는(食) '밥'을 의미합니다.", // 저녁밥의 飯
        '有': "又 (또 우, 손) + 月 (고기 육). 손(又)에 고기(月)를 '가지다'는 의미입니다.",
        '名': "夕 (저녁 석) + 口 (입 구). 저녁(夕)에 어두워 보이지 않으니 입(口)으로 이름을 불러 확인하다.",
        '雪': "雨 (비 우) + 彗 (비 혜, 빗자루). 비(雨)처럼 내리는 빗자루(彗) 모양의 '눈'을 의미합니다.",
        '用': "卜 (점 복) + 中 (가운데 중). 점(卜)을 쳐서 쓸모(中)를 본다는 의미에서 '쓰다'입니다.",
        '事': "깃발을 손에 들고 일을 하는 모양에서 '일'을 의미합니다.", // 용무의 事
        '洋': "氵(물 수) + 羊 (양 양). 양(羊)처럼 넓게 펼쳐진 물(氵), '바다'를 의미합니다.", // 양복의 洋
        '服': "月 (고기 육, 몸) + 卩 (병부 절, 무릎 꿇다) + 又 (또 우, 손). 몸(月)에 맞게 손(又)으로 옷을 입히거나 입는다는(卩) 의미입니다.", // 양복의 服
        '予': "亅 (갈고리 궐) + 又 (또 우, 손). 베틀의 북을 손(又)으로 밀어 '미리' 준비하다는 의미입니다.",
        '習': "羽 (깃 우) + 白 (흰 백, 여기서는 새끼 새). 새(白)가 날갯짓(羽)을 반복하여 '익히다'는 의미입니다.", // 예습의 習
        '定': "宀 (집 면) + 正 (바를 정). 집(宀)안이 바르게(正) '정해지다'는 의미입니다.",
        '報': "幸 (다행 행) +卩(병부 절, 무릎꿇다) + 又(손 우). 죄인(幸)이 손(又)으로 무릎꿇고(卩) 보고한다는 의미에서 '알리다'입니다.",
        '夜': "亠 (머리 두) + 亻(사람 인) + 夕 (저녁 석) + 夂 (뒤져올 치). 저녁(夕)이 되어 사람(亻)이 활동을 마치고(夂) 쉬는 '밤'을 의미합니다.",
        '弱': "弓 (활 궁) 두 개 + 羽 (깃 우). 약한 활(弓) 두 개에 깃(羽)을 단 모양에서 '약하다'는 의미가 나왔습니다.",
        '来': "보리(麦)가 자란 모양을 본뜬 글자로, '오다'는 뜻입니다.",
        '週': "辶 (쉬엄쉬엄 갈 착) + 周 (두루 주). 일정한 기간을 두고 한 바퀴 '돌아오다'는 의미입니다.", // 다음 주의 週
        '料': "米 (쌀 미) + 斗 (말 두). 쌀(米)을 말(斗)로 헤아려 '헤아리다', '재료'를 의미합니다.", // 요리의 料
        '理': "王 (구슬 옥) + 里 (마을 리). 구슬(王)의 결(里)을 다듬듯 '다스리다', '이치'를 의미합니다.", // 요리의 理
        '旅': "方 (깃발 방) + 从 (따를 종). 깃발(方) 아래 여러 사람(从)이 따르는 '나그네'를 의미합니다.",
        '行': "네거리 모양을 본뜬 글자로, '가다', '하다'는 뜻을 가집니다.", // 여행의 行
        '館': "食 (밥 식) + 官 (벼슬 관). 손님에게 음식을 제공하며 머무르게 하는 '집'을 의미합니다.", // 여관의 館
        '用': "卜 (점 복) + 中 (가운데 중). 점(卜)을 쳐서 쓸모(中)를 본다는 의미에서 '쓰다'입니다.", // 이용의 用
        '悪': "亞 (버금 아, 추하다) + 心 (마음 심). 추한(亞) 마음(心)을 의미합니다.",
        '私': "禾 (벼 화) + 厶 (사사 사). 벼(禾)를 사사로이(厶) 거둔다는 의미에서 '나'를 뜻합니다."
    };

    function parseWordData() {
        const currentRawData = allRawData[currentPartKey] || '';
        console.log(`parseWordData: Starting to parse for part: ${currentPartKey}.`);

        // 기존의 rawWordData 변수를 모두 currentRawData로 변경합니다.
        if (typeof currentRawData !== 'string' || !currentRawData.trim()) {
            console.error("parseWordData: currentRawData is not a string or is empty.");
            wordData = [];
            originalWordData = [];
            return;
        }

        const lines = currentRawData.trim().split('\n');
        console.log(`parseWordData: Found ${lines.length} lines.`);
        const wordPattern = /^(.+?)\s+([^,]+?),\s*(.+)$/;

        const parsedData = lines.map((line, index) => {
            const trimmedLine = line.trim();
            if (!trimmedLine) return null;
            const match = trimmedLine.match(wordPattern);

            if (match) {
                const form = match[1].trim();
                const reading = match[2].trim();
                const meaning = match[3].trim();
                const etymologyKey = form.charAt(0);
                const kanjiEtymology = kanjiEtymologies[etymologyKey] || "한자 풀이 정보가 없습니다.";
                return { id: index + 1, form, reading, meaning, kanjiEtymology };
            } else {
                const commaParts = trimmedLine.split(',');
                if (commaParts.length >= 2) {
                    const formAndReadingPart = commaParts[0].trim();
                    const meaningPart = commaParts.slice(1).join(',').trim();
                    const spaceParts = formAndReadingPart.split(/\s+/);
                    let form = formAndReadingPart;
                    let reading = "";
                    if (spaceParts.length > 1) {
                        reading = spaceParts.pop();
                        form = spaceParts.join(" ");
                    } else {
                        if (/^[^\u3040-\u309F\u30A0-\u30FF]+$/.test(formAndReadingPart) && formAndReadingPart.length === 1) {
                            form = formAndReadingPart;
                        }
                    }
                    const etymologyKey = form.charAt(0);
                    const kanjiEtymology = kanjiEtymologies[etymologyKey] || "한자 풀이 정보가 없습니다.";
                    console.warn(`parseWordData: Line ${index + 1} using fallback parsing: "${trimmedLine}" -> F:${form}, R:${reading}, M:${meaningPart}`);
                    return { id: index + 1, form, reading, meaning: meaningPart, kanjiEtymology };

                } else {
                    console.warn(`parseWordData: Line ${index + 1} did not match pattern and fallback failed: "${trimmedLine}"`);
                    return null;
                }
            }
        }).filter(item => item !== null);

        console.log(`parseWordData: Successfully parsed ${parsedData.length} items.`);
        if (parsedData.length > 0) {
            console.log("parseWordData: First parsed item:", JSON.stringify(parsedData[0]));
            if (parsedData.length > 1) {
                console.log("parseWordData: Last parsed item:", JSON.stringify(parsedData[parsedData.length-1]));
            }
        } else if (lines.length > 0 && lines[0].trim()) {
            console.warn("parseWordData: No items were parsed successfully, but there were lines. Check pattern and data format.");
            console.log("parseWordData: First line for manual check:", lines[0].trim());
        }

        wordData = [...parsedData];
        originalWordData = [...parsedData];
        console.log("parseWordData: Finished. wordData length:", wordData.length);
    }

    function loadVoices() {
        voices = synth.getVoices();
        const koreanVoicePreferences = ['Microsoft Heami Online (Natural) - Korean (Korea)', 'Google 한국의', '유나 (고품질)', '소라 (고품질)', '유나', '소라', 'Yuna (Enhanced)', 'Sora (Enhanced)', 'Yuna', 'Sora'];
        for (const name of koreanVoicePreferences) {
            const voice = voices.find(v => v.lang === 'ko-KR' && v.name === name);
            if (voice) { preferredKoreanVoice = voice; break; }
        }
        if (!preferredKoreanVoice) preferredKoreanVoice = voices.find(v => v.lang === 'ko-KR' && (v.name.toLowerCase().includes('female') || v.name.includes('여성')));
        if (!preferredKoreanVoice) preferredKoreanVoice = voices.find(v => v.lang === 'ko-KR');

        const japaneseVoicePreferences = ['Google 日本語', 'Microsoft Ayumi Online (Natural) - Japanese (Japan)', 'Microsoft Haruka Online (Natural) - Japanese (Japan)', 'Microsoft Haruka Desktop - Japanese', 'Kyoko (Enhanced)', 'Otoya (Enhanced)', 'Kyoko', 'Otoya'];
        for (const name of japaneseVoicePreferences) {
            const voice = voices.find(v => v.lang === 'ja-JP' && v.name === name);
            if (voice) { preferredJapaneseVoice = voice; break; }
        }
        if (!preferredJapaneseVoice) preferredJapaneseVoice = voices.find(v => v.lang === 'ja-JP' && (v.name.toLowerCase().includes('female') || v.name.includes('여성')));
        if (!preferredJapaneseVoice) preferredJapaneseVoice = voices.find(v => v.lang === 'ja-JP');
    }

    if (synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = loadVoices;
    }
    loadVoices();

    function speak(text, lang, callback) {
        if (voices.length === 0) loadVoices();
        if (synth.speaking) synth.cancel();

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        let targetVoice = null;
        if (lang === 'ko-KR') targetVoice = preferredKoreanVoice;
        else if (lang === 'ja-JP') targetVoice = preferredJapaneseVoice;

        if (targetVoice) utterance.voice = targetVoice;
        else {
            const fallbackVoice = voices.find(v => v.lang === lang);
            if (fallbackVoice) utterance.voice = fallbackVoice;
        }
        utterance.onend = () => { if (callback) callback(); };
        utterance.onerror = (event) => {
            console.error('SpeechSynthesisUtterance.onerror:', event.error, event);
            const isCancellationError = event.error === 'canceled' || event.error === 'interrupted';
            if (isAutoPlaying && !isCancellationError) {
                if (typeof alert !== 'undefined') alert(`음성 재생 중 오류: ${event.error || 'N/A'}. 자동 재생 중지.`);
                stopAutoPlay();
            }
            if (callback) callback();
        };
        synth.speak(utterance);
    }

    function cleanTextForSpeech(text) { return text.replace(/\([^)]*\)/g, '').trim(); }

    function playCurrentCardAudio() {
        if (!isAutoPlaying || wordData.length === 0) return;
        const card = wordData[currentCardIndex];
        if (memorizedStatus[card.id] && wordData.length > 1) {
            playNextCard();
            return;
        }

        speechQueue = [];
        currentSpeechUtteranceIndex = 0;
        speechQueue.push({ text: card.reading, lang: 'ja-JP' });
        speechQueue.push({ text: cleanTextForSpeech(card.meaning), lang: 'ko-KR' });
        playNextSpeechInQueue();
    }

    function playNextSpeechInQueue() {
        if (!isAutoPlaying || currentSpeechUtteranceIndex >= speechQueue.length) {
            if (isAutoPlaying) { setTimeout(playNextCard, 700); }
            return;
        }
        const speechItem = speechQueue[currentSpeechUtteranceIndex];
        speak(speechItem.text, speechItem.lang, () => {
            currentSpeechUtteranceIndex++;
            playNextSpeechInQueue();
        });
    }

    function playNextCard() {
        if (!isAutoPlaying || wordData.length === 0) return;
        currentCardIndex = (currentCardIndex + 1) % wordData.length;
        // hiraganaVisible and meaningVisible are shown during autoplay
        // kanjiEtymologyVisible state is respected (not forced true)
        displayCard();
        playCurrentCardAudio();
    }

    function startAutoPlay() {
        if (isTestMode || wordData.length === 0) return;
        if (synth.speaking) synth.cancel();
        isAutoPlaying = true;
        playPauseButtonEl.innerHTML = '<i class="fas fa-pause"></i>';
        currentSpeechUtteranceIndex = 0;
        // Details are shown based on their individual states during autoplay
        // but kanjiEtymologyVisible is now global and respected
        hiraganaVisible = true; // Typically shown during autoplay
        meaningVisible = true;  // Typically shown during autoplay
        displayCard();
        playCurrentCardAudio();
    }

    function stopAutoPlay() {
        isAutoPlaying = false;
        synth.cancel();
        speechQueue = [];
        currentSpeechUtteranceIndex = 0;
        playPauseButtonEl.innerHTML = '<i class="fas fa-play"></i>';
    }

    // `loadMemorizedStatus`, `saveMemorizedStatus`, `updateMemorizedButton` 함수를
    // 찾아서 아래 코드로 각각 교체합니다.
    function loadMemorizedStatus() {
        const storedStatus = localStorage.getItem('japaneseWordMemorizedStatus_v5'); // 버전업
        if (storedStatus) {
            memorizedStatus = JSON.parse(storedStatus);
        } else {
            memorizedStatus = {
                'part1': {}, 'part2': {}, 'part3': {}, 'part4': {}
            };
        }
    }
    function saveMemorizedStatus() {
        localStorage.setItem('japaneseWordMemorizedStatus_v5', JSON.stringify(memorizedStatus));
    }
    function updateMemorizedButton() {
        if (wordData.length === 0 || !wordData[currentCardIndex]) {
            // ... (기존 코드와 동일)
            return;
        }
        const card = wordData[currentCardIndex];
        // 현재 파트의 암기 상태를 확인하도록 수정
        if (memorizedStatus[currentPartKey] && memorizedStatus[currentPartKey][card.id]) {
            toggleMemorizedButtonEl.textContent = '암기 ✅';
            toggleMemorizedButtonEl.className = 'text-xs sm:text-sm py-1 px-2 rounded-md focus:outline-none bg-green-200 hover:bg-green-300 text-green-700';
        } else {
            toggleMemorizedButtonEl.textContent = '암기 ❌';
            toggleMemorizedButtonEl.className = 'text-xs sm:text-sm py-1 px-2 rounded-md focus:outline-none bg-gray-200 hover:bg-gray-300 text-gray-700';
        }
    }


    // `toggleMemorizedButtonEl`의 이벤트 리스너를 찾아 아래와 같이 수정합니다.
    toggleMemorizedButtonEl.addEventListener('click', () => {
        if (wordData.length === 0 || !wordData[currentCardIndex]) return;
        const card = wordData[currentCardIndex];
        // 현재 파트에 대한 암기 상태 객체가 없으면 생성
        if (!memorizedStatus[currentPartKey]) {
            memorizedStatus[currentPartKey] = {};
        }
        // 현재 파트의 암기 상태를 토글
        memorizedStatus[currentPartKey][card.id] = !memorizedStatus[currentPartKey][card.id];
        updateMemorizedButton();
        saveMemorizedStatus();
    });

    function displayCard() {
        if (wordData.length === 0) {
            wordFormEl.textContent = "단어 데이터가 없습니다.";
            wordReadingElContainer.classList.add('content-hidden');
            meaningContainerEl.classList.add('content-hidden');
            kanjiEtymologyContainerEl.classList.add('content-hidden');
            wordIdEl.textContent = 'ID: ---';
            if (toggleMemorizedButtonEl) {
                toggleMemorizedButtonEl.textContent = '';
                toggleMemorizedButtonEl.className = 'text-xs sm:text-sm py-1 px-2 rounded-md focus:outline-none';
            }
            return;
        }
        const card = wordData[currentCardIndex];
        if (!card) {
            console.error("displayCard: current card is undefined at index", currentCardIndex);
            wordFormEl.textContent = "오류: 카드 로딩 실패";
            return;
        }
        wordIdEl.textContent = `ID: ${String(card.id).padStart(String(originalWordData.length).length, '0')}`;
        wordFormEl.textContent = card.form;
        wordReadingEl.textContent = card.reading;
        wordMeaningEl.textContent = card.meaning;
        kanjiEtymologyEl.textContent = card.kanjiEtymology || "한자 풀이 정보가 없습니다.";

        wordFormEl.onclick = () => speak(card.reading, 'ja-JP');
        wordReadingEl.onclick = () => speak(card.reading, 'ja-JP');
        wordMeaningEl.onclick = () => speak(card.meaning, 'ko-KR');
        kanjiEtymologyEl.onclick = () => speak(card.kanjiEtymology, 'ko-KR');

        if (hiraganaVisible) showHiraganaDOM(); else hideHiraganaDOM();
        if (meaningVisible) showMeaningDOM(); else hideMeaningDOM();
        // Kanji Etymology visibility is controlled by the global kanjiEtymologyVisible state
        if (kanjiEtymologyVisible) showKanjiEtymologyDOM(); else hideKanjiEtymologyDOM();
        updateRevealButtonsText();
        updateMemorizedButton();
        updateToggleKanjiEtymologyInSettingsButtonText();
    }

    function hideHiraganaDOM() {
        wordReadingElContainer.classList.remove('content-visible');
        wordReadingElContainer.classList.add('content-hidden');
    }
    function showHiraganaDOM() {
        wordReadingElContainer.classList.remove('content-hidden');
        wordReadingElContainer.classList.add('content-visible');
    }
    function hideMeaningDOM() {
        meaningContainerEl.classList.remove('content-visible');
        meaningContainerEl.classList.add('content-hidden');
    }
    function showMeaningDOM() {
        meaningContainerEl.classList.remove('content-hidden');
        meaningContainerEl.classList.add('content-visible');
    }
    function hideKanjiEtymologyDOM() {
        kanjiEtymologyContainerEl.classList.remove('content-visible');
        kanjiEtymologyContainerEl.classList.add('content-hidden');
    }
    function showKanjiEtymologyDOM() {
        kanjiEtymologyContainerEl.classList.remove('content-hidden');
        kanjiEtymologyContainerEl.classList.add('content-visible');
    }

    function updateRevealButtonsText() {
        revealHiraganaButton.textContent = hiraganaVisible ? '히라가나 숨기기' : '히라가나 보기';
        revealMeaningButton.textContent = meaningVisible ? '한글 뜻 숨기기' : '한글 뜻 보기';
    }

    function updateToggleKanjiEtymologyInSettingsButtonText() {
        if (toggleKanjiEtymologyInSettingsButtonEl) {
            toggleKanjiEtymologyInSettingsButtonEl.innerHTML = `<i class="fas fa-font"></i> ${kanjiEtymologyVisible ? '한자 풀이 숨기기 (전체)' : '한자 풀이 보기 (전체)'}`;
        }
    }

    function toggleHiragana() {
        hiraganaVisible = !hiraganaVisible;
        displayCard(); // Re-render card to reflect change
    }
    function toggleMeaning() {
        meaningVisible = !meaningVisible;
        displayCard(); // Re-render card to reflect change
    }
    function toggleKanjiEtymology() { // This is the global toggle
        kanjiEtymologyVisible = !kanjiEtymologyVisible;
        displayCard(); // Re-render current card with new global setting
        updateToggleKanjiEtymologyInSettingsButtonText();
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function generateTestChoices(correctReading, allWordData) {
        const choices = [correctReading];
        let otherReadings = [...new Set(allWordData.map(item => item.reading))].filter(r => r !== correctReading);
        shuffleArray(otherReadings);
        for (let i = 0; i < 3 && i < otherReadings.length; i++) { choices.push(otherReadings[i]); }
        let attempts = 0;
        while (choices.length < 4 && otherReadings.length > (choices.length -1 + attempts) && attempts < 10) {
            const nextOption = otherReadings[choices.length -1 + attempts];
            if (nextOption && !choices.includes(nextOption)) {
                choices.push(nextOption);
            }
            attempts++;
        }
        return shuffleArray(choices);
    }

    function loadTestItem() {
        if (wordData.length === 0) return;
        const currentWord = shuffledTestData[currentTestItemIndex];

        if (currentTestItemIndex >= totalQuestionsInTest) {
            testResultEl.innerHTML = `학습 종료! 최종 점수: ${score} / ${totalQuestionsInTest}`;
            testResultEl.className = 'text-center font-semibold mb-4 p-2 rounded-md bg-blue-100 text-blue-700 min-h-[2.5rem] meaning-display';
            testWordFormEl.textContent = "모든 문제를 다 풀었습니다!";
            testChoicesEl.innerHTML = '';
            nextTestItemButtonEl.disabled = true;
            quitTestButtonEl.textContent = "낱말카드로";
            return;
        }

        testProgressEl.textContent = `문제 ${currentTestItemIndex + 1} / ${totalQuestionsInTest} (ID: ${String(currentWord.id).padStart(String(originalWordData.length).length, '0')})`;
        testWordFormEl.textContent = currentWord.form;
        testResultEl.textContent = '';
        testResultEl.className = 'text-center font-semibold mb-4 p-2 rounded-md min-h-[2.5rem] meaning-display';
        testChoicesEl.innerHTML = '';

        const choices = generateTestChoices(currentWord.reading, wordData);
        if (choices.length < 2) {
            testChoicesEl.innerHTML = '<p class="text-red-500 text-center">보기를 생성하기에 데이터가 부족합니다.</p>';
            nextTestItemButtonEl.disabled = false;
            return;
        }
        choices.forEach(choiceText => {
            const choiceButton = document.createElement('button');
            choiceButton.textContent = choiceText;
            choiceButton.classList.add('choice-button', 'p-3', 'rounded-md', 'border', 'border-gray-300', 'hover:bg-indigo-100', 'focus:outline-none', 'focus:ring-2', 'focus:ring-indigo-400', 'text-sm', 'sm:text-base', 'reading-display');
            choiceButton.addEventListener('click', () => handleTestChoiceSelection(choiceButton, choiceText, currentWord));
            testChoicesEl.appendChild(choiceButton);
        });
        nextTestItemButtonEl.disabled = true;
    }

    function handleTestChoiceSelection(selectedButton, selectedReading, correctWord) {
        const buttons = testChoicesEl.querySelectorAll('button');
        buttons.forEach(button => {
            button.disabled = true;
            button.classList.remove('hover:bg-indigo-100');
            if (button.textContent === correctWord.reading) { button.classList.add('correct'); }
            else if (button === selectedButton && selectedReading !== correctWord.reading) { button.classList.add('selected-incorrect'); }
            else if (button.textContent !== correctWord.reading) { button.classList.add('bg-gray-100', 'text-gray-500', 'border-gray-300', 'opacity-50');}
        });

        let resultHTML = '';
        if (selectedReading === correctWord.reading) {
            resultHTML = `<span class="text-green-700">정답!</span> ${correctWord.form} (<span class="reading-display">${correctWord.reading}</span>): ${correctWord.meaning}`;
            testResultEl.className = 'text-center font-semibold mb-4 p-2 rounded-md bg-green-100 text-green-700 min-h-[2.5rem]';
            score++;
        } else {
            resultHTML = `<span class="text-red-700">오답.</span> 정답: ${correctWord.form} (<span class="reading-display">${correctWord.reading}</span>): ${correctWord.meaning}`;
            testResultEl.className = 'text-center font-semibold mb-4 p-2 rounded-md bg-red-100 text-red-700 min-h-[2.5rem]';
        }
        testResultEl.innerHTML = resultHTML;
        nextTestItemButtonEl.disabled = false;
        nextTestItemButtonEl.focus();
    }

    function toggleAppMode() {
        if (isTestMode) {
            endTestMode();
        } else {
            startTestMode();
        }
        settingsModalEl.style.display = 'none';
    }

    function startTestMode() {
        if (wordData.length === 0) {
            if(typeof alert !== 'undefined') alert("학습할 단어가 없습니다.");
            return;
        }
        isTestMode = true;
        if (isAutoPlaying) stopAutoPlay();
        learningModeContainerEl.classList.add('hidden');
        testModeContainerEl.classList.remove('hidden');
        appTopBarEl.classList.add('hidden');
        switchModeInSettingsButtonEl.innerHTML = '<i class="fas fa-book-open"></i> 낱말카드 모드로';

        shuffledTestData = shuffleArray([...wordData]);
        currentTestItemIndex = 0;
        score = 0;
        totalQuestionsInTest = shuffledTestData.length;
        nextTestItemButtonEl.disabled = true;
        quitTestButtonEl.textContent = "학습 종료";
        testResultEl.textContent = '';
        loadTestItem();
    }
    function endTestMode() {
        isTestMode = false;
        learningModeContainerEl.classList.remove('hidden');
        testModeContainerEl.classList.add('hidden');
        appTopBarEl.classList.remove('hidden');
        switchModeInSettingsButtonEl.innerHTML = '<i class="fas fa-vial"></i> 학습/테스트 모드로';
        if (wordData.length > 0) {
            // Restore hiragana/meaning visibility to default (hidden) when exiting test mode
            hiraganaVisible = false;
            meaningVisible = false;
            // kanjiEtymologyVisible remains as per global setting
            displayCard();
        }
    }

    function updateSettingsButtonsState() {
        if (resetCardOrderButtonEl) {
            resetCardOrderButtonEl.disabled = !isShuffled;
            if(!isShuffled) {
                resetCardOrderButtonEl.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                resetCardOrderButtonEl.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
        updateToggleKanjiEtymologyInSettingsButtonText();
    }

    // Event Listeners
    playPauseButtonEl.addEventListener('click', () => {
        if (isTestMode) return;
        if (isAutoPlaying) stopAutoPlay(); else startAutoPlay();
    });
    settingsButtonEl.addEventListener('click', () => {
        if (isAutoPlaying) stopAutoPlay();
        updateSettingsButtonsState();
        settingsModalEl.style.display = 'block';
    });
    closeSettingsModalButtonEl.addEventListener('click', () => {
        settingsModalEl.style.display = 'none';
    });

    toggleKanjiEtymologyInSettingsButtonEl.addEventListener('click', () => {
        if (isAutoPlaying) stopAutoPlay();
        toggleKanjiEtymology(); // This now handles the global state and updates the current card
    });

    shuffleCardsButtonEl.addEventListener('click', () => {
        if (wordData.length > 0) {
            shuffleArray(wordData);
            currentCardIndex = 0;
            hiraganaVisible = false; // Reset visibility for new card order
            meaningVisible = false;
            // kanjiEtymologyVisible is global, so it's not reset here
            isShuffled = true;
            displayCard();
            if(typeof alert !== 'undefined') alert("카드 순서를 섞었습니다!");
            updateSettingsButtonsState();
        }
        settingsModalEl.style.display = 'none';
    });
    resetCardOrderButtonEl.addEventListener('click', () => {
        if (wordData.length > 0 && originalWordData.length > 0) {
            wordData = [...originalWordData];
            currentCardIndex = 0;
            hiraganaVisible = false; // Reset visibility
            meaningVisible = false;
            // kanjiEtymologyVisible is global
            isShuffled = false;
            displayCard();
            if(typeof alert !== 'undefined') alert("카드 순서를 원래대로 되돌렸습니다.");
            updateSettingsButtonsState();
        }
        settingsModalEl.style.display = 'none';
    });
    // 기존의 openAllWordsListFromSettingsButtonEl.addEventListener('click', ...) 함수를 찾아서 아래 코드로 완전히 교체하세요.

    openAllWordsListFromSettingsButtonEl.addEventListener('click', () => {
        settingsModalEl.style.display = 'none';
        if (wordData.length === 0) return;

        const currentDataToDisplay = isShuffled ? wordData : originalWordData;
        const searchInput = document.getElementById('wordSearchInput');
        const statsEl = document.getElementById('wordListStats');
        const listEl = document.getElementById('allWordsListEl');

        // 단어 목록을 화면에 그리는 함수
        const renderWordList = (wordArray) => {
            listEl.innerHTML = ''; // 기존 목록 초기화

            if (wordArray.length === 0) {
                listEl.innerHTML = '<p class="text-center text-gray-500 py-6">일치하는 단어가 없습니다.</p>';
                return;
            }

            const fragment = document.createDocumentFragment();
            wordArray.forEach((item, index) => {
                const listItem = document.createElement('div');
                const isMemorized = memorizedStatus[currentPartKey]?.[item.id];

                // 더 깔끔한 디자인을 위한 클래스 설정
                listItem.className = `flex items-center gap-3 p-3 border-b border-gray-200 last:border-b-0 cursor-pointer hover:bg-gray-100 ${isMemorized ? 'bg-green-50/50' : ''}`;

                // 1. 번호
                const numberSpan = document.createElement('span');
                numberSpan.className = 'w-8 text-right text-xs font-medium text-gray-500';
                numberSpan.textContent = `${index + 1}.`;

                // 2. 단어 정보 (단어 + 발음)
                const wordInfoDiv = document.createElement('div');
                wordInfoDiv.className = 'flex-grow';
                wordInfoDiv.innerHTML = `
                <div class="font-semibold text-gray-800 word-display">${item.form}</div>
                <div class="text-sm text-gray-500 reading-display">${item.reading}</div>
            `;

                // 3. 뜻
                const meaningSpan = document.createElement('div');
                meaningSpan.className = 'w-2/5 text-sm text-gray-700 meaning-display';
                meaningSpan.textContent = item.meaning;

                // 4. 암기 상태 아이콘
                const statusSpan = document.createElement('span');
                statusSpan.className = 'text-lg pl-2';
                statusSpan.textContent = isMemorized ? '✅' : '❌';

                listItem.append(numberSpan, wordInfoDiv, meaningSpan, statusSpan);

                // 목록 아이템 클릭 이벤트
                listItem.addEventListener('click', () => {
                    const targetIndex = wordData.findIndex(wd => wd.id === item.id);
                    if (targetIndex !== -1) {
                        currentCardIndex = targetIndex;
                        hiraganaVisible = false;
                        meaningVisible = false;
                        displayCard();
                        allWordsModalEl.style.display = 'none';
                    }
                });

                fragment.appendChild(listItem);
            });
            listEl.appendChild(fragment);
        };

        // 통계 계산 및 표시
        const totalCount = currentDataToDisplay.length;
        const memorizedCount = currentDataToDisplay.filter(item => memorizedStatus[currentPartKey]?.[item.id]).length;
        statsEl.textContent = `총 ${totalCount}개 | 암기 ${memorizedCount}개`;

        // 검색 입력창 초기화 및 전체 목록 표시
        searchInput.value = '';
        renderWordList(currentDataToDisplay);

        // 검색창 키 입력 이벤트 리스너
        searchInput.onkeyup = () => {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const filteredData = currentDataToDisplay.filter(item =>
                item.form.toLowerCase().includes(searchTerm) ||
                item.reading.toLowerCase().includes(searchTerm) ||
                item.meaning.toLowerCase().includes(searchTerm)
            );
            renderWordList(filteredData);
        };

        allWordsModalEl.style.display = 'block';
    });
    switchModeInSettingsButtonEl.addEventListener('click', toggleAppMode);

    revealHiraganaButton.addEventListener('click', () => {
        if (isAutoPlaying) stopAutoPlay();
        toggleHiragana();
    });
    revealMeaningButton.addEventListener('click', () => {
        if (isAutoPlaying) stopAutoPlay();
        toggleMeaning();
    });

    prevButton.addEventListener('click', () => {
        if (isAutoPlaying) stopAutoPlay();
        if (wordData.length === 0) return;
        currentCardIndex = (currentCardIndex - 1 + wordData.length) % wordData.length;
        hiraganaVisible = false; // Reset for new card
        meaningVisible = false;  // Reset for new card
        // kanjiEtymologyVisible is global and will be respected by displayCard()
        displayCard();
    });
    nextButton.addEventListener('click', () => {
        if (isAutoPlaying) stopAutoPlay();
        if (wordData.length === 0) return;
        currentCardIndex = (currentCardIndex + 1) % wordData.length;
        hiraganaVisible = false; // Reset for new card
        meaningVisible = false;  // Reset for new card
        // kanjiEtymologyVisible is global
        displayCard();
    });
    toggleMemorizedButtonEl.addEventListener('click', () => {
        if (wordData.length === 0 || !wordData[currentCardIndex]) return;
        const card = wordData[currentCardIndex];
        memorizedStatus[card.id] = !memorizedStatus[card.id];
        updateMemorizedButton();
        saveMemorizedStatus();
    });

    closeAllWordsModalButtonEl.addEventListener('click', () => { allWordsModalEl.style.display = 'none'; });
    window.addEventListener('click', (event) => {
        if (event.target == allWordsModalEl) allWordsModalEl.style.display = 'none';
        if (event.target == settingsModalEl) settingsModalEl.style.display = 'none';
    });

    quitTestButtonEl.addEventListener('click', endTestMode);
    nextTestItemButtonEl.addEventListener('click', () => {
        currentTestItemIndex++;
        loadTestItem();
    });

    // initializeApp 함수 바로 위에 아래 새로운 함수를 추가합니다.
    function switchPart(newPartKey, isInitialLoad = false) {
        if (!isInitialLoad && currentPartKey === newPartKey) {
            settingsModalEl.style.display = 'none';
            return;
        }

        if(isAutoPlaying) stopAutoPlay();

        currentPartKey = newPartKey;
        localStorage.setItem('japaneseAppCurrentPart_Word', newPartKey); // 새 키 사용

        // UI에서 현재 활성화된 파트 버튼 스타일 업데이트
        document.querySelectorAll('.part-select-button').forEach(button => {
            if (button.dataset.part === newPartKey) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        });

        // 새 파트의 데이터로 앱 상태 리셋
        initializeApp();

        if(!isInitialLoad) {
            const partButton = document.querySelector(`.part-select-button.active`);
            if(partButton && typeof alert !== 'undefined') {
                alert(`'${partButton.textContent}' 파트로 전환되었습니다.`);
            }
        }
        if(settingsModalEl) settingsModalEl.style.display = 'none';
    }


    // 기존 initializeApp 함수를 아래 내용으로 **교체**합니다.
    function initializeApp() {
        console.log("initializeApp: Initializing for part:", currentPartKey);

        parseWordData(); // 현재 파트 키에 따라 데이터를 파싱

        if (!memorizedStatus[currentPartKey]) {
            memorizedStatus[currentPartKey] = {};
        }

        currentCardIndex = 0;
        isShuffled = false;
        endTestMode();

        const buttonsToDisable = [
            playPauseButtonEl, settingsButtonEl,
            revealHiraganaButton, revealMeaningButton,
            prevButton, nextButton, toggleMemorizedButtonEl,
            shuffleCardsButtonEl, resetCardOrderButtonEl, openAllWordsListFromSettingsButtonEl,
            switchModeInSettingsButtonEl, toggleKanjiEtymologyInSettingsButtonEl
        ];

        if (wordData.length > 0) {
            console.log("initializeApp: Word data found. Length:", wordData.length);
            hiraganaVisible = false;
            meaningVisible = false;
            kanjiEtymologyVisible = false;
            displayCard();
            buttonsToDisable.forEach(btn => { if(btn) btn.disabled = false; });
        } else {
            console.warn("initializeApp: No word data found. Displaying 'No data' message.");
            displayCard();
            buttonsToDisable.forEach(btn => { if(btn) btn.disabled = true; });
        }

        learningModeContainerEl.classList.remove('hidden');
        testModeContainerEl.classList.add('hidden');
        appTopBarEl.classList.remove('hidden');
        switchModeInSettingsButtonEl.innerHTML = '<i class="fas fa-vial"></i> 학습/테스트 모드로';
        updateSettingsButtonsState();
        console.log("initializeApp: Initialization complete for part:", currentPartKey);
    }

    // 스크립트 맨 마지막에 있던 initializeApp(); 호출을 찾아서 아래 코드로 교체합니다.
    document.addEventListener('DOMContentLoaded', () => {
        // 1. 암기 상태 로드
        loadMemorizedStatus();

        // 2. 마지막으로 선택한 파트 불러오기 (없으면 기본값)
        const savedPart = localStorage.getItem('japaneseAppCurrentPart_Word') || 'part1';

        // 3. 파트 전환 버튼에 이벤트 리스너 추가
        document.querySelectorAll('.part-select-button').forEach(button => {
            button.addEventListener('click', () => {
                switchPart(button.dataset.part);
            });
        });

        // 4. 앱 시작
        switchPart(savedPart, true); // true는 최초 로딩임을 의미
    });

    // 기존의 initializeApp(); 단독 호출은 지워주세요.
</script>
</body>
</html>
